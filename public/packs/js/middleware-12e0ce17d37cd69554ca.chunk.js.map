{"version":3,"sources":["webpack:///./node_modules/@june-so/analytics-next/dist/pkg/plugins/middleware/index.js"],"names":["applyDestinationMiddleware","destination","evt","middleware","this","applyMiddleware","event","fn","nextCalled","returnedEvent","_a","_b","label","payload","clone","traverse","integration","next","obj","sent","integrations","_i","middleware_1","md","result","length","sourceMiddlewarePlugin","apply","ctx","retry","type","reason","name","version","isLoaded","load","Promise","resolve","track","page","identify","alias","group"],"mappings":"2FAAA,gKAIO,SAASA,EAA2BC,EAAaC,EAAKC,GAC3D,OAAO,YAAUC,UAAM,OAAQ,GAAQ,WACrC,SAASC,EAAgBC,EAAOC,GAC9B,OAAO,YAAUH,UAAM,OAAQ,GAAQ,WACrC,IAAII,EAAYC,EAEZC,EAEJ,OAAO,YAAYN,MAAM,SAAUO,GACjC,OAAQA,EAAGC,OACT,KAAK,EAGH,OAFAJ,GAAa,EACbC,EAAgB,KACT,CAAC,EAEN,YAAUF,EAAG,CACbM,QAAS,YAASP,EAAO,CACvBQ,OAAO,EACPC,UAAU,IAEZC,YAAaf,EACbgB,KAAM,SAAcf,GAClBM,GAAa,EAED,OAARN,IACFO,EAAgB,MAGdP,IACFO,EAAgBP,EAAIgB,UAK5B,KAAK,EAQH,OAPAP,EAAGQ,OAEEX,GAAgC,OAAlBC,IAEjBA,EAAcW,aAAe,YAAS,YAAS,GAAId,EAAMc,gBAAgBV,EAAK,IAAOT,IAAe,EAAOS,KAGtG,CAAC,EAEND,UAMZ,IAAIY,EAAIC,EAAcC,EAAIC,EAE1B,OAAO,YAAYpB,MAAM,SAAUM,GACjC,OAAQA,EAAGE,OACT,KAAK,EACHS,EAAK,EAAGC,EAAenB,EACvBO,EAAGE,MAAQ,EAEb,KAAK,EACH,OAAMS,EAAKC,EAAaG,QAGxBF,EAAKD,EAAaD,GACX,CAAC,EAENhB,EAAgBH,EAAKqB,KANiB,CAAC,EAEvC,GAMJ,KAAK,EAGH,GAAe,QAFfC,EAASd,EAAGS,QAGV,MAAO,CAAC,EAEN,MAGJjB,EAAMsB,EACNd,EAAGE,MAAQ,EAEb,KAAK,EAEH,OADAS,IACO,CAAC,EAEN,GAEJ,KAAK,EACH,MAAO,CAAC,EAENnB,UAKL,SAASwB,EAAuBnB,EAAIa,GACzC,SAASO,EAAMC,GACb,OAAO,YAAUxB,UAAM,OAAQ,GAAQ,WACrC,IAAII,EACJ,OAAO,YAAYJ,MAAM,SAAUM,GACjC,OAAQA,EAAGE,OACT,KAAK,EAEH,OADAJ,GAAa,EACN,CAAC,EAEN,YAAUD,EAAG,CACbM,QAAS,YAASe,EAAItB,MAAO,CAC3BQ,OAAO,EACPC,UAAU,IAEZK,aAA+B,OAAjBA,QAA0C,IAAjBA,EAA0BA,EAAe,GAChFH,KAAM,SAAcf,GAClBM,GAAa,EAETN,IACF0B,EAAItB,MAAQJ,EAAIgB,UAKxB,KAAK,EAGH,GAFAR,EAAGS,QAEEX,EACH,MAAM,IAAI,IAAmB,CAC3BqB,OAAO,EACPC,KAAM,0BACNC,OAAQ,uCAIZ,MAAO,CAAC,EAENH,UAMZ,MAAO,CACLI,KAAM,qBAAuBzB,EAAGyB,KAChCF,KAAM,SACNG,QAAS,QACTC,SAAU,WACR,OAAO,GAETC,KAAM,SAAcP,GAClB,OAAOQ,QAAQC,QAAQT,IAEzBU,MAAOX,EACPY,KAAMZ,EACNa,SAAUb,EACVc,MAAOd,EACPe,MAAOf","file":"js/middleware-12e0ce17d37cd69554ca.chunk.js","sourcesContent":["import { __assign, __awaiter, __generator } from \"tslib\";\nimport { ContextCancelation } from '../../core/context';\nimport { asPromise } from '../../lib/as-promise';\nimport { toFacade } from '../../lib/to-facade';\nexport function applyDestinationMiddleware(destination, evt, middleware) {\n  return __awaiter(this, void 0, void 0, function () {\n    function applyMiddleware(event, fn) {\n      return __awaiter(this, void 0, void 0, function () {\n        var nextCalled, returnedEvent;\n\n        var _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              nextCalled = false;\n              returnedEvent = null;\n              return [4\n              /*yield*/\n              , asPromise(fn({\n                payload: toFacade(event, {\n                  clone: true,\n                  traverse: false\n                }),\n                integration: destination,\n                next: function next(evt) {\n                  nextCalled = true;\n\n                  if (evt === null) {\n                    returnedEvent = null;\n                  }\n\n                  if (evt) {\n                    returnedEvent = evt.obj;\n                  }\n                }\n              }))];\n\n            case 1:\n              _b.sent();\n\n              if (!nextCalled && returnedEvent !== null) {\n                returnedEvent = returnedEvent;\n                returnedEvent.integrations = __assign(__assign({}, event.integrations), (_a = {}, _a[destination] = false, _a));\n              }\n\n              return [2\n              /*return*/\n              , returnedEvent];\n          }\n        });\n      });\n    }\n\n    var _i, middleware_1, md, result;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _i = 0, middleware_1 = middleware;\n          _a.label = 1;\n\n        case 1:\n          if (!(_i < middleware_1.length)) return [3\n          /*break*/\n          , 4];\n          md = middleware_1[_i];\n          return [4\n          /*yield*/\n          , applyMiddleware(evt, md)];\n\n        case 2:\n          result = _a.sent();\n\n          if (result === null) {\n            return [2\n            /*return*/\n            , null];\n          }\n\n          evt = result;\n          _a.label = 3;\n\n        case 3:\n          _i++;\n          return [3\n          /*break*/\n          , 1];\n\n        case 4:\n          return [2\n          /*return*/\n          , evt];\n      }\n    });\n  });\n}\nexport function sourceMiddlewarePlugin(fn, integrations) {\n  function apply(ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      var nextCalled;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            nextCalled = false;\n            return [4\n            /*yield*/\n            , asPromise(fn({\n              payload: toFacade(ctx.event, {\n                clone: true,\n                traverse: false\n              }),\n              integrations: integrations !== null && integrations !== void 0 ? integrations : {},\n              next: function next(evt) {\n                nextCalled = true;\n\n                if (evt) {\n                  ctx.event = evt.obj;\n                }\n              }\n            }))];\n\n          case 1:\n            _a.sent();\n\n            if (!nextCalled) {\n              throw new ContextCancelation({\n                retry: false,\n                type: 'middleware_cancellation',\n                reason: 'Middleware `next` function skipped'\n              });\n            }\n\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  }\n\n  return {\n    name: \"Source Middleware \" + fn.name,\n    type: 'before',\n    version: '0.1.0',\n    isLoaded: function isLoaded() {\n      return true;\n    },\n    load: function load(ctx) {\n      return Promise.resolve(ctx);\n    },\n    track: apply,\n    page: apply,\n    identify: apply,\n    alias: apply,\n    group: apply\n  };\n}"],"sourceRoot":""}