{"version":3,"sources":["webpack:///./node_modules/@june-so/analytics-next/dist/pkg/plugins/schema-filter/index.js"],"names":["schemaFilter","track","settings","filter","ctx","plan","ev","event","planEvent","enabled","updateEvent","integrations","All","disabledActions","_a","_b","Object","keys","disabledIntegrations","i","disabledRemotePlugins","remotePlugins","forEach","p","int","name","includes","push","reduce","acc","sub","partnerAction","disabledActionDestinations","version","isLoaded","load","Promise","resolve","type","page","alias","identify","group"],"mappings":"4FAAA,gEAsCO,SAASA,EAAaC,EAAOC,GAClC,SAASC,EAAOC,GACd,IAAIC,EAAOJ,EACPK,EAAKF,EAAIG,MAAMA,MAEnB,GAAIF,GAAQC,EAAI,CACd,IAAIE,EAAYH,EAAKC,GAErB,IAAkF,KAA/D,OAAdE,QAAoC,IAAdA,OAAuB,EAASA,EAAUC,SAKnE,OAJAL,EAAIM,YAAY,eAAgB,YAAS,YAAS,GAAIN,EAAIG,MAAMI,cAAe,CAC7EC,KAAK,EACL,cAAc,KAETR,EAEP,IAAIS,EAnDZ,SAAoCR,EAAMH,GACxC,IAAIY,EAAIC,EAER,IAAKV,IAASW,OAAOC,KAAKZ,GACxB,MAAO,GAGT,IAAIa,EAAuBF,OAAOC,KAAKZ,EAAKM,cAAcR,QAAO,SAAUgB,GACzE,OAAgC,IAAzBd,EAAKM,aAAaQ,MAIvBC,EAAwB,GAQ5B,OAPmC,QAAjCN,EAAKZ,EAASmB,qBAAkC,IAAPP,EAAgBA,EAAK,IAAIQ,SAAQ,SAAUC,GACpFL,EAAqBI,SAAQ,SAAUE,IACjCD,EAAEE,KAAKC,SAASF,IAAQA,EAAIE,SAASH,EAAEE,QACzCL,EAAsBO,KAAKJ,EAAEE,aAIO,QAAjCV,EAAKb,EAASmB,qBAAkC,IAAPN,EAAgBA,EAAK,IAAIa,QAAO,SAAUC,EAAKN,GAY/F,OAVIA,EAAErB,SAAwB,eACxBkB,EAAsBM,SAASH,EAAEE,OAEnCF,EAAErB,SAAwB,cAAEoB,SAC5B,SAAUQ,GACR,OAAOD,EAAIN,EAAEE,KAAO,IAAMK,EAAIC,gBAAiB,KAK9CF,IACN,IAkByBG,CAA2BxB,EAAWN,GAC5DE,EAAIM,YAAY,eAAgB,YAAS,YAAS,YAAS,GAAIN,EAAIG,MAAMI,cAA6B,OAAdH,QAAoC,IAAdA,OAAuB,EAASA,EAAUG,cAAeE,IAI3K,OAAOT,EAGT,MAAO,CACLqB,KAAM,gBACNQ,QAAS,QACTC,SAAU,WACR,OAAO,GAETC,KAAM,WACJ,OAAOC,QAAQC,WAEjBC,KAAM,SACNC,KAAMpC,EACNqC,MAAOrC,EACPF,MAAOE,EACPsC,SAAUtC,EACVuC,MAAOvC","file":"js/schemaFilter-32708e03d809c645a4ca.chunk.js","sourcesContent":["import { __assign } from \"tslib\";\n\nfunction disabledActionDestinations(plan, settings) {\n  var _a, _b;\n\n  if (!plan || !Object.keys(plan)) {\n    return {};\n  }\n\n  var disabledIntegrations = Object.keys(plan.integrations).filter(function (i) {\n    return plan.integrations[i] === false;\n  }); // This accounts for cases like Fullstory, where the settings.integrations\n  // contains a \"Fullstory\" object but settings.remotePlugins contains \"Fullstory (Actions)\"\n\n  var disabledRemotePlugins = [];\n  ((_a = settings.remotePlugins) !== null && _a !== void 0 ? _a : []).forEach(function (p) {\n    disabledIntegrations.forEach(function (int) {\n      if (p.name.includes(int) || int.includes(p.name)) {\n        disabledRemotePlugins.push(p.name);\n      }\n    });\n  });\n  return ((_b = settings.remotePlugins) !== null && _b !== void 0 ? _b : []).reduce(function (acc, p) {\n    // @ts-expect-error element implicitly has an 'any' type because p.settings is a JSONValue\n    if (p.settings['subscriptions']) {\n      if (disabledRemotePlugins.includes(p.name)) {\n        // @ts-expect-error element implicitly has an 'any' type because p.settings is a JSONValue\n        p.settings['subscriptions'].forEach( // @ts-expect-error parameter 'sub' implicitly has an 'any' type\n        function (sub) {\n          return acc[p.name + \" \" + sub.partnerAction] = false;\n        });\n      }\n    }\n\n    return acc;\n  }, {});\n}\n\nexport function schemaFilter(track, settings) {\n  function filter(ctx) {\n    var plan = track;\n    var ev = ctx.event.event;\n\n    if (plan && ev) {\n      var planEvent = plan[ev];\n\n      if ((planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) === false) {\n        ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), {\n          All: false,\n          'Segment.io': true\n        }));\n        return ctx;\n      } else {\n        var disabledActions = disabledActionDestinations(planEvent, settings);\n        ctx.updateEvent('integrations', __assign(__assign(__assign({}, ctx.event.integrations), planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations), disabledActions));\n      }\n    }\n\n    return ctx;\n  }\n\n  return {\n    name: 'Schema Filter',\n    version: '0.1.0',\n    isLoaded: function isLoaded() {\n      return true;\n    },\n    load: function load() {\n      return Promise.resolve();\n    },\n    type: 'before',\n    page: filter,\n    alias: filter,\n    track: filter,\n    identify: filter,\n    group: filter\n  };\n}"],"sourceRoot":""}