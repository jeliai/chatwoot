{"version":3,"file":"queryString.bundle.2f88d6c809c48bcdd6d2.js","mappings":";;;;;;;;;;;;;;AAAyC;AAQlC,SAAS,WAAW,CACzB,SAAoB,EACpB,KAAa;IAEb,IAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC;IACrC,CAAC,CAAC,IAAI,GAAG,KAAK;IACd,IAAM,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;IAEhC,IAAM,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,UAAC,GAAsB,EAAE,GAAG;QAC5D,SAAS,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,EAAtB,CAAC,UAAE,CAAC,QAAkB;QAC7B,GAAG,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC;QACvC,OAAO,GAAG;IACZ,CAAC,EAAE,EAAE,CAAC;IAEN,IAAM,KAAK,GAAG,EAAE;IAEhB,iDAAiD;IACzC,WAAO,GAAyB,MAAM,QAA/B,EAAE,SAAS,GAAc,MAAM,UAApB,EAAE,OAAO,GAAK,MAAM,QAAX,CAAW;IAE9C,IAAI,OAAO,EAAE;QACX,IAAM,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC;YACvC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;YACnB,CAAC,CAAC,MAAM,CAAC,OAAO;QAClB,IAAM,MAAM,GAAG,uDAAU,CAAC,YAAY,EAAE,MAAM,CAAC;QAE/C,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;KAC5C;IAED,IAAI,SAAS,EAAE;QACb,IAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;YAC3C,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YACrB,CAAC,CAAC,MAAM,CAAC,SAAS;QACpB,IAAM,KAAK,GAAG,uDAAU,CAAC,WAAW,EAAE,MAAM,CAAC;QAC7C,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;KAC1C;IAED,IAAI,OAAO,EAAE;QACX,IAAM,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC;YAC1C,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;YACnB,CAAC,CAAC,MAAM,CAAC,OAAO;QAClB,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC;KACjC;IACD,gDAAgD;IAEhD,OAAO,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AAC3B,CAAC;;;;;;;;;;;;;;;ACnDD;;;;;IAKI;AACG,SAAS,UAAU,CACxB,MAAc,EACd,MAAyB;IAEzB,OAAO,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,UAAC,GAAsB,EAAE,GAAW;QACpE,IAAI,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;YAC1B,IAAM,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC;YACvC,GAAG,CAAC,KAAK,CAAC,GAAG,MAAM,CAAC,GAAG,CAAE;SAC1B;QACD,OAAO,GAAG;IACZ,CAAC,EAAE,EAAE,CAAC;AACR,CAAC","sources":["webpack://@june-so/analytics-next/./src/core/query-string/index.ts","webpack://@june-so/analytics-next/./src/core/query-string/pickPrefix.ts"],"sourcesContent":["import { pickPrefix } from './pickPrefix'\nimport { Analytics } from '../../analytics'\nimport { Context } from '../context'\n\nexport interface QueryStringParams {\n  [key: string]: string | null\n}\n\nexport function queryString(\n  analytics: Analytics,\n  query: string\n): Promise<Context[]> {\n  const a = document.createElement('a')\n  a.href = query\n  const parsed = a.search.slice(1)\n\n  const params = parsed.split('&').reduce((acc: QueryStringParams, str) => {\n    const [k, v] = str.split('=')\n    acc[k] = decodeURI(v).replace('+', ' ')\n    return acc\n  }, {})\n\n  const calls = []\n\n  /* eslint-disable @typescript-eslint/camelcase */\n  const { ajs_uid, ajs_event, ajs_aid } = params\n\n  if (ajs_uid) {\n    const uid = Array.isArray(params.ajs_uid)\n      ? params.ajs_uid[0]\n      : params.ajs_uid\n    const traits = pickPrefix('ajs_trait_', params)\n\n    calls.push(analytics.identify(uid, traits))\n  }\n\n  if (ajs_event) {\n    const event = Array.isArray(params.ajs_event)\n      ? params.ajs_event[0]\n      : params.ajs_event\n    const props = pickPrefix('ajs_prop_', params)\n    calls.push(analytics.track(event, props))\n  }\n\n  if (ajs_aid) {\n    const anonId = Array.isArray(params.ajs_aid)\n      ? params.ajs_aid[0]\n      : params.ajs_aid\n    analytics.setAnonymousId(anonId)\n  }\n  /* eslint-enable @typescript-eslint/camelcase */\n\n  return Promise.all(calls)\n}\n","import { QueryStringParams } from '.'\n\n/**\n * Returns an object containing only the properties prefixed by the input\n * string.\n * Ex: prefix('ajs_traits_', { ajs_traits_address: '123 St' })\n * will return { address: '123 St' }\n **/\nexport function pickPrefix(\n  prefix: string,\n  object: QueryStringParams\n): QueryStringParams {\n  return Object.keys(object).reduce((acc: QueryStringParams, key: string) => {\n    if (key.startsWith(prefix)) {\n      const field = key.substr(prefix.length)\n      acc[field] = object[key]!\n    }\n    return acc\n  }, {})\n}\n"],"names":[],"sourceRoot":""}