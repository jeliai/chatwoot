{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptors.js\";\nimport Cookies from 'js-cookie';\nimport { addClasses, loadCSS, removeClasses, onLocationChangeListener } from './DOMHelpers';\nimport { body, widgetHolder, createBubbleHolder, createBubbleIcon, bubbleImg, chatBubble, closeBubble, bubbleHolder, createNotificationBubble, onClickChatBubble, onBubbleClick, setBubbleText, addUnreadClass, removeUnreadClass } from './bubbleHelpers';\nimport { dispatchWindowEvent } from 'shared/helpers/CustomEventHelper';\nimport { CHATWOOT_ERROR, CHATWOOT_READY } from '../widget/constants/sdkEvents';\nimport { SET_USER_ERROR } from '../widget/constants/errorTypes';\nimport { getUserCookieName } from './cookieHelpers';\nimport { getAlertAudio, initOnEvents } from 'shared/helpers/AudioNotificationHelper';\nimport { isFlatWidgetStyle } from './settingsHelper';\nimport { popoutChatWindow as _popoutChatWindow } from '../widget/helpers/popoutHelper';\n\nvar updateAuthCookie = function updateAuthCookie(cookieContent) {\n  return Cookies.set('cw_conversation', cookieContent, {\n    expires: 365,\n    sameSite: 'Lax'\n  });\n};\n\nexport var IFrameHelper = {\n  getUrl: function getUrl(_ref) {\n    var baseUrl = _ref.baseUrl,\n        websiteToken = _ref.websiteToken;\n    return \"\".concat(baseUrl, \"/widget?website_token=\").concat(websiteToken);\n  },\n  createFrame: function createFrame(_ref2) {\n    var baseUrl = _ref2.baseUrl,\n        websiteToken = _ref2.websiteToken;\n\n    if (IFrameHelper.getAppFrame()) {\n      return;\n    }\n\n    loadCSS();\n    var iframe = document.createElement('iframe');\n    var cwCookie = Cookies.get('cw_conversation');\n    var widgetUrl = IFrameHelper.getUrl({\n      baseUrl: baseUrl,\n      websiteToken: websiteToken\n    });\n\n    if (cwCookie) {\n      widgetUrl = \"\".concat(widgetUrl, \"&cw_conversation=\").concat(cwCookie);\n    }\n\n    iframe.src = widgetUrl;\n    iframe.id = 'chatwoot_live_chat_widget';\n    iframe.style.visibility = 'hidden';\n    var holderClassName = \"woot-widget-holder woot--hide woot-elements--\".concat(window.$chatwoot.position);\n\n    if (window.$chatwoot.hideMessageBubble) {\n      holderClassName += \" woot-widget--without-bubble\";\n    }\n\n    if (isFlatWidgetStyle(window.$chatwoot.widgetStyle)) {\n      holderClassName += \" woot-widget-holder--flat\";\n    }\n\n    addClasses(widgetHolder, holderClassName);\n    widgetHolder.appendChild(iframe);\n    body.appendChild(widgetHolder);\n    IFrameHelper.initPostMessageCommunication();\n    IFrameHelper.initWindowSizeListener();\n    IFrameHelper.preventDefaultScroll();\n  },\n  getAppFrame: function getAppFrame() {\n    return document.getElementById('chatwoot_live_chat_widget');\n  },\n  getBubbleHolder: function getBubbleHolder() {\n    return document.getElementsByClassName('woot--bubble-holder');\n  },\n  sendMessage: function sendMessage(key, value) {\n    var element = IFrameHelper.getAppFrame();\n    element.contentWindow.postMessage(\"chatwoot-widget:\".concat(JSON.stringify(_objectSpread({\n      event: key\n    }, value))), '*');\n  },\n  initPostMessageCommunication: function initPostMessageCommunication() {\n    window.onmessage = function (e) {\n      if (typeof e.data !== 'string' || e.data.indexOf('chatwoot-widget:') !== 0) {\n        return;\n      }\n\n      var message = JSON.parse(e.data.replace('chatwoot-widget:', ''));\n\n      if (typeof IFrameHelper.events[message.event] === 'function') {\n        IFrameHelper.events[message.event](message);\n      }\n    };\n  },\n  initWindowSizeListener: function initWindowSizeListener() {\n    window.addEventListener('resize', function () {\n      return IFrameHelper.toggleCloseButton();\n    });\n  },\n  preventDefaultScroll: function preventDefaultScroll() {\n    widgetHolder.addEventListener('wheel', function (event) {\n      var deltaY = event.deltaY;\n      var contentHeight = widgetHolder.scrollHeight;\n      var visibleHeight = widgetHolder.offsetHeight;\n      var scrollTop = widgetHolder.scrollTop;\n\n      if (scrollTop === 0 && deltaY < 0 || visibleHeight + scrollTop === contentHeight && deltaY > 0) {\n        event.preventDefault();\n      }\n    });\n  },\n  setFrameHeightToFitContent: function setFrameHeightToFitContent(extraHeight, isFixedHeight) {\n    var iframe = IFrameHelper.getAppFrame();\n    var updatedIframeHeight = isFixedHeight ? \"\".concat(extraHeight, \"px\") : '100%';\n    if (iframe) iframe.setAttribute('style', \"height: \".concat(updatedIframeHeight, \" !important\"));\n  },\n  setupAudioListeners: function setupAudioListeners() {\n    var _window$$chatwoot$bas = window.$chatwoot.baseUrl,\n        baseUrl = _window$$chatwoot$bas === void 0 ? '' : _window$$chatwoot$bas;\n    getAlertAudio(baseUrl, 'widget').then(function () {\n      return initOnEvents.forEach(function (event) {\n        document.removeEventListener(event, IFrameHelper.setupAudioListeners, false);\n      });\n    });\n  },\n  events: {\n    loaded: function loaded(message) {\n      updateAuthCookie(message.config.authToken);\n      window.$chatwoot.hasLoaded = true;\n      IFrameHelper.sendMessage('config-set', {\n        locale: window.$chatwoot.locale,\n        position: window.$chatwoot.position,\n        hideMessageBubble: window.$chatwoot.hideMessageBubble,\n        showPopoutButton: window.$chatwoot.showPopoutButton,\n        widgetStyle: window.$chatwoot.widgetStyle,\n        darkMode: window.$chatwoot.darkMode\n      });\n      IFrameHelper.onLoad({\n        widgetColor: message.config.channelConfig.widgetColor\n      });\n      IFrameHelper.toggleCloseButton();\n\n      if (window.$chatwoot.user) {\n        IFrameHelper.sendMessage('set-user', window.$chatwoot.user);\n      }\n\n      window.playAudioAlert = function () {};\n\n      initOnEvents.forEach(function (e) {\n        document.addEventListener(e, IFrameHelper.setupAudioListeners, false);\n      });\n\n      if (!window.$chatwoot.resetTriggered) {\n        dispatchWindowEvent({\n          eventName: CHATWOOT_READY\n        });\n      }\n    },\n    error: function error(_ref3) {\n      var errorType = _ref3.errorType,\n          data = _ref3.data;\n      dispatchWindowEvent({\n        eventName: CHATWOOT_ERROR,\n        data: data\n      });\n\n      if (errorType === SET_USER_ERROR) {\n        Cookies.remove(getUserCookieName());\n      }\n    },\n    setBubbleLabel: function setBubbleLabel(message) {\n      setBubbleText(window.$chatwoot.launcherTitle || message.label);\n    },\n    setAuthCookie: function setAuthCookie(_ref4) {\n      var widgetAuthToken = _ref4.data.widgetAuthToken;\n      updateAuthCookie(widgetAuthToken);\n    },\n    toggleBubble: function toggleBubble(state) {\n      var bubbleState = {};\n\n      if (state === 'open') {\n        bubbleState.toggleValue = true;\n      } else if (state === 'close') {\n        bubbleState.toggleValue = false;\n      }\n\n      onBubbleClick(bubbleState);\n    },\n    popoutChatWindow: function popoutChatWindow(_ref5) {\n      var baseUrl = _ref5.baseUrl,\n          websiteToken = _ref5.websiteToken,\n          locale = _ref5.locale;\n      var cwCookie = Cookies.get('cw_conversation');\n      window.$chatwoot.toggle('close');\n\n      _popoutChatWindow(baseUrl, websiteToken, locale, cwCookie);\n    },\n    closeWindow: function closeWindow() {\n      onBubbleClick({\n        toggleValue: false\n      });\n      removeUnreadClass();\n    },\n    onBubbleToggle: function onBubbleToggle(isOpen) {\n      IFrameHelper.sendMessage('toggle-open', {\n        isOpen: isOpen\n      });\n\n      if (isOpen) {\n        IFrameHelper.pushEvent('webwidget.triggered');\n      }\n    },\n    onLocationChange: function onLocationChange(_ref6) {\n      var referrerURL = _ref6.referrerURL,\n          referrerHost = _ref6.referrerHost;\n      IFrameHelper.sendMessage('change-url', {\n        referrerURL: referrerURL,\n        referrerHost: referrerHost\n      });\n    },\n    updateIframeHeight: function updateIframeHeight(message) {\n      var _message$extraHeight = message.extraHeight,\n          extraHeight = _message$extraHeight === void 0 ? 0 : _message$extraHeight,\n          isFixedHeight = message.isFixedHeight;\n      IFrameHelper.setFrameHeightToFitContent(extraHeight, isFixedHeight);\n    },\n    setUnreadMode: function setUnreadMode() {\n      addUnreadClass();\n      onBubbleClick({\n        toggleValue: true\n      });\n    },\n    resetUnreadMode: function resetUnreadMode() {\n      return removeUnreadClass();\n    },\n    handleNotificationDot: function handleNotificationDot(event) {\n      if (window.$chatwoot.hideMessageBubble) {\n        return;\n      }\n\n      var bubbleElement = document.querySelector('.woot-widget-bubble');\n\n      if (event.unreadMessageCount > 0 && !bubbleElement.classList.contains('unread-notification')) {\n        addClasses(bubbleElement, 'unread-notification');\n      } else if (event.unreadMessageCount === 0) {\n        removeClasses(bubbleElement, 'unread-notification');\n      }\n    },\n    closeChat: function closeChat() {\n      onBubbleClick({\n        toggleValue: false\n      });\n    },\n    playAudio: function playAudio() {\n      window.playAudioAlert();\n    }\n  },\n  pushEvent: function pushEvent(eventName) {\n    IFrameHelper.sendMessage('push-event', {\n      eventName: eventName\n    });\n  },\n  onLoad: function onLoad(_ref7) {\n    var widgetColor = _ref7.widgetColor;\n    var iframe = IFrameHelper.getAppFrame();\n    iframe.style.visibility = '';\n    iframe.setAttribute('id', \"chatwoot_live_chat_widget\");\n\n    if (IFrameHelper.getBubbleHolder().length) {\n      return;\n    }\n\n    createBubbleHolder(window.$chatwoot.hideMessageBubble);\n    onLocationChangeListener();\n    var className = 'woot-widget-bubble';\n    var closeBtnClassName = \"woot-elements--\".concat(window.$chatwoot.position, \" woot-widget-bubble woot--close woot--hide\");\n\n    if (isFlatWidgetStyle(window.$chatwoot.widgetStyle)) {\n      className += ' woot-widget-bubble--flat';\n      closeBtnClassName += ' woot-widget-bubble--flat';\n    }\n\n    var chatIcon = createBubbleIcon({\n      className: className,\n      src: bubbleImg,\n      target: chatBubble\n    });\n    addClasses(closeBubble, closeBtnClassName);\n    chatIcon.style.background = widgetColor;\n    closeBubble.style.background = widgetColor;\n    bubbleHolder.appendChild(chatIcon);\n    bubbleHolder.appendChild(closeBubble);\n    bubbleHolder.appendChild(createNotificationBubble());\n    onClickChatBubble();\n  },\n  toggleCloseButton: function toggleCloseButton() {\n    var isMobile = false;\n\n    if (window.matchMedia('(max-width: 668px)').matches) {\n      isMobile = true;\n    }\n\n    IFrameHelper.sendMessage('toggle-close-button', {\n      isMobile: isMobile\n    });\n  }\n};","map":{"version":3,"sources":["/Users/s.dastan/Desktop/chatwoot/chatwoot/app/javascript/sdk/IFrameHelper.js"],"names":["Cookies","addClasses","loadCSS","removeClasses","onLocationChangeListener","body","widgetHolder","createBubbleHolder","createBubbleIcon","bubbleImg","chatBubble","closeBubble","bubbleHolder","createNotificationBubble","onClickChatBubble","onBubbleClick","setBubbleText","addUnreadClass","removeUnreadClass","dispatchWindowEvent","CHATWOOT_ERROR","CHATWOOT_READY","SET_USER_ERROR","getUserCookieName","getAlertAudio","initOnEvents","isFlatWidgetStyle","popoutChatWindow","updateAuthCookie","cookieContent","set","expires","sameSite","IFrameHelper","getUrl","baseUrl","websiteToken","createFrame","getAppFrame","iframe","document","createElement","cwCookie","get","widgetUrl","src","id","style","visibility","holderClassName","window","$chatwoot","position","hideMessageBubble","widgetStyle","appendChild","initPostMessageCommunication","initWindowSizeListener","preventDefaultScroll","getElementById","getBubbleHolder","getElementsByClassName","sendMessage","key","value","element","contentWindow","postMessage","JSON","stringify","event","onmessage","e","data","indexOf","message","parse","replace","events","addEventListener","toggleCloseButton","deltaY","contentHeight","scrollHeight","visibleHeight","offsetHeight","scrollTop","preventDefault","setFrameHeightToFitContent","extraHeight","isFixedHeight","updatedIframeHeight","setAttribute","setupAudioListeners","then","forEach","removeEventListener","loaded","config","authToken","hasLoaded","locale","showPopoutButton","darkMode","onLoad","widgetColor","channelConfig","user","playAudioAlert","resetTriggered","eventName","error","errorType","remove","setBubbleLabel","launcherTitle","label","setAuthCookie","widgetAuthToken","toggleBubble","state","bubbleState","toggleValue","toggle","closeWindow","onBubbleToggle","isOpen","pushEvent","onLocationChange","referrerURL","referrerHost","updateIframeHeight","setUnreadMode","resetUnreadMode","handleNotificationDot","bubbleElement","querySelector","unreadMessageCount","classList","contains","closeChat","playAudio","length","className","closeBtnClassName","chatIcon","target","background","isMobile","matchMedia","matches"],"mappings":"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","sourcesContent":["import Cookies from 'js-cookie';\nimport {\n  addClasses,\n  loadCSS,\n  removeClasses,\n  onLocationChangeListener,\n} from './DOMHelpers';\nimport {\n  body,\n  widgetHolder,\n  createBubbleHolder,\n  createBubbleIcon,\n  bubbleImg,\n  chatBubble,\n  closeBubble,\n  bubbleHolder,\n  createNotificationBubble,\n  onClickChatBubble,\n  onBubbleClick,\n  setBubbleText,\n  addUnreadClass,\n  removeUnreadClass,\n} from './bubbleHelpers';\nimport { dispatchWindowEvent } from 'shared/helpers/CustomEventHelper';\nimport { CHATWOOT_ERROR, CHATWOOT_READY } from '../widget/constants/sdkEvents';\nimport { SET_USER_ERROR } from '../widget/constants/errorTypes';\nimport { getUserCookieName } from './cookieHelpers';\nimport {\n  getAlertAudio,\n  initOnEvents,\n} from 'shared/helpers/AudioNotificationHelper';\nimport { isFlatWidgetStyle } from './settingsHelper';\nimport { popoutChatWindow } from '../widget/helpers/popoutHelper';\n\nconst updateAuthCookie = cookieContent =>\n  Cookies.set('cw_conversation', cookieContent, {\n    expires: 365,\n    sameSite: 'Lax',\n  });\n\nexport const IFrameHelper = {\n  getUrl({ baseUrl, websiteToken }) {\n    return `${baseUrl}/widget?website_token=${websiteToken}`;\n  },\n  createFrame: ({ baseUrl, websiteToken }) => {\n    if (IFrameHelper.getAppFrame()) {\n      return;\n    }\n\n    loadCSS();\n    const iframe = document.createElement('iframe');\n    const cwCookie = Cookies.get('cw_conversation');\n    let widgetUrl = IFrameHelper.getUrl({ baseUrl, websiteToken });\n    if (cwCookie) {\n      widgetUrl = `${widgetUrl}&cw_conversation=${cwCookie}`;\n    }\n    iframe.src = widgetUrl;\n\n    iframe.id = 'chatwoot_live_chat_widget';\n    iframe.style.visibility = 'hidden';\n\n    let holderClassName = `woot-widget-holder woot--hide woot-elements--${window.$chatwoot.position}`;\n    if (window.$chatwoot.hideMessageBubble) {\n      holderClassName += ` woot-widget--without-bubble`;\n    }\n    if (isFlatWidgetStyle(window.$chatwoot.widgetStyle)) {\n      holderClassName += ` woot-widget-holder--flat`;\n    }\n\n    addClasses(widgetHolder, holderClassName);\n    widgetHolder.appendChild(iframe);\n    body.appendChild(widgetHolder);\n    IFrameHelper.initPostMessageCommunication();\n    IFrameHelper.initWindowSizeListener();\n    IFrameHelper.preventDefaultScroll();\n  },\n  getAppFrame: () => document.getElementById('chatwoot_live_chat_widget'),\n  getBubbleHolder: () => document.getElementsByClassName('woot--bubble-holder'),\n  sendMessage: (key, value) => {\n    const element = IFrameHelper.getAppFrame();\n    element.contentWindow.postMessage(\n      `chatwoot-widget:${JSON.stringify({ event: key, ...value })}`,\n      '*'\n    );\n  },\n  initPostMessageCommunication: () => {\n    window.onmessage = e => {\n      if (\n        typeof e.data !== 'string' ||\n        e.data.indexOf('chatwoot-widget:') !== 0\n      ) {\n        return;\n      }\n      const message = JSON.parse(e.data.replace('chatwoot-widget:', ''));\n      if (typeof IFrameHelper.events[message.event] === 'function') {\n        IFrameHelper.events[message.event](message);\n      }\n    };\n  },\n  initWindowSizeListener: () => {\n    window.addEventListener('resize', () => IFrameHelper.toggleCloseButton());\n  },\n  preventDefaultScroll: () => {\n    widgetHolder.addEventListener('wheel', event => {\n      const deltaY = event.deltaY;\n      const contentHeight = widgetHolder.scrollHeight;\n      const visibleHeight = widgetHolder.offsetHeight;\n      const scrollTop = widgetHolder.scrollTop;\n\n      if (\n        (scrollTop === 0 && deltaY < 0) ||\n        (visibleHeight + scrollTop === contentHeight && deltaY > 0)\n      ) {\n        event.preventDefault();\n      }\n    });\n  },\n\n  setFrameHeightToFitContent: (extraHeight, isFixedHeight) => {\n    const iframe = IFrameHelper.getAppFrame();\n    const updatedIframeHeight = isFixedHeight ? `${extraHeight}px` : '100%';\n\n    if (iframe)\n      iframe.setAttribute('style', `height: ${updatedIframeHeight} !important`);\n  },\n\n  setupAudioListeners: () => {\n    const { baseUrl = '' } = window.$chatwoot;\n    getAlertAudio(baseUrl, 'widget').then(() =>\n      initOnEvents.forEach(event => {\n        document.removeEventListener(\n          event,\n          IFrameHelper.setupAudioListeners,\n          false\n        );\n      })\n    );\n  },\n\n  events: {\n    loaded: message => {\n      updateAuthCookie(message.config.authToken);\n      window.$chatwoot.hasLoaded = true;\n      IFrameHelper.sendMessage('config-set', {\n        locale: window.$chatwoot.locale,\n        position: window.$chatwoot.position,\n        hideMessageBubble: window.$chatwoot.hideMessageBubble,\n        showPopoutButton: window.$chatwoot.showPopoutButton,\n        widgetStyle: window.$chatwoot.widgetStyle,\n        darkMode: window.$chatwoot.darkMode,\n      });\n      IFrameHelper.onLoad({\n        widgetColor: message.config.channelConfig.widgetColor,\n      });\n      IFrameHelper.toggleCloseButton();\n\n      if (window.$chatwoot.user) {\n        IFrameHelper.sendMessage('set-user', window.$chatwoot.user);\n      }\n\n      window.playAudioAlert = () => {};\n\n      initOnEvents.forEach(e => {\n        document.addEventListener(e, IFrameHelper.setupAudioListeners, false);\n      });\n\n      if (!window.$chatwoot.resetTriggered) {\n        dispatchWindowEvent({ eventName: CHATWOOT_READY });\n      }\n    },\n    error: ({ errorType, data }) => {\n      dispatchWindowEvent({ eventName: CHATWOOT_ERROR, data: data });\n\n      if (errorType === SET_USER_ERROR) {\n        Cookies.remove(getUserCookieName());\n      }\n    },\n\n    setBubbleLabel(message) {\n      setBubbleText(window.$chatwoot.launcherTitle || message.label);\n    },\n\n    setAuthCookie({ data: { widgetAuthToken } }) {\n      updateAuthCookie(widgetAuthToken);\n    },\n\n    toggleBubble: state => {\n      let bubbleState = {};\n      if (state === 'open') {\n        bubbleState.toggleValue = true;\n      } else if (state === 'close') {\n        bubbleState.toggleValue = false;\n      }\n\n      onBubbleClick(bubbleState);\n    },\n\n    popoutChatWindow: ({ baseUrl, websiteToken, locale }) => {\n      const cwCookie = Cookies.get('cw_conversation');\n      window.$chatwoot.toggle('close');\n      popoutChatWindow(baseUrl, websiteToken, locale, cwCookie);\n    },\n\n    closeWindow: () => {\n      onBubbleClick({ toggleValue: false });\n      removeUnreadClass();\n    },\n\n    onBubbleToggle: isOpen => {\n      IFrameHelper.sendMessage('toggle-open', { isOpen });\n      if (isOpen) {\n        IFrameHelper.pushEvent('webwidget.triggered');\n      }\n    },\n    onLocationChange: ({ referrerURL, referrerHost }) => {\n      IFrameHelper.sendMessage('change-url', {\n        referrerURL,\n        referrerHost,\n      });\n    },\n    updateIframeHeight: message => {\n      const { extraHeight = 0, isFixedHeight } = message;\n\n      IFrameHelper.setFrameHeightToFitContent(extraHeight, isFixedHeight);\n    },\n\n    setUnreadMode: () => {\n      addUnreadClass();\n      onBubbleClick({ toggleValue: true });\n    },\n\n    resetUnreadMode: () => removeUnreadClass(),\n    handleNotificationDot: event => {\n      if (window.$chatwoot.hideMessageBubble) {\n        return;\n      }\n\n      const bubbleElement = document.querySelector('.woot-widget-bubble');\n      if (\n        event.unreadMessageCount > 0 &&\n        !bubbleElement.classList.contains('unread-notification')\n      ) {\n        addClasses(bubbleElement, 'unread-notification');\n      } else if (event.unreadMessageCount === 0) {\n        removeClasses(bubbleElement, 'unread-notification');\n      }\n    },\n\n    closeChat: () => {\n      onBubbleClick({ toggleValue: false });\n    },\n\n    playAudio: () => {\n      window.playAudioAlert();\n    },\n  },\n  pushEvent: eventName => {\n    IFrameHelper.sendMessage('push-event', { eventName });\n  },\n\n  onLoad: ({ widgetColor }) => {\n    const iframe = IFrameHelper.getAppFrame();\n    iframe.style.visibility = '';\n    iframe.setAttribute('id', `chatwoot_live_chat_widget`);\n\n    if (IFrameHelper.getBubbleHolder().length) {\n      return;\n    }\n    createBubbleHolder(window.$chatwoot.hideMessageBubble);\n    onLocationChangeListener();\n\n    let className = 'woot-widget-bubble';\n    let closeBtnClassName = `woot-elements--${window.$chatwoot.position} woot-widget-bubble woot--close woot--hide`;\n\n    if (isFlatWidgetStyle(window.$chatwoot.widgetStyle)) {\n      className += ' woot-widget-bubble--flat';\n      closeBtnClassName += ' woot-widget-bubble--flat';\n    }\n\n    const chatIcon = createBubbleIcon({\n      className,\n      src: bubbleImg,\n      target: chatBubble,\n    });\n\n    addClasses(closeBubble, closeBtnClassName);\n\n    chatIcon.style.background = widgetColor;\n    closeBubble.style.background = widgetColor;\n\n    bubbleHolder.appendChild(chatIcon);\n    bubbleHolder.appendChild(closeBubble);\n    bubbleHolder.appendChild(createNotificationBubble());\n    onClickChatBubble();\n  },\n  toggleCloseButton: () => {\n    let isMobile = false;\n    if (window.matchMedia('(max-width: 668px)').matches) {\n      isMobile = true;\n    }\n    IFrameHelper.sendMessage('toggle-close-button', { isMobile });\n  },\n};\n"]},"metadata":{},"sourceType":"module"}