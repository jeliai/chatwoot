{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Track = void 0;\n\nvar inherits_1 = __importDefault(require(\"inherits\"));\n\nvar facade_1 = require(\"./facade\");\n\nvar identify_1 = require(\"./identify\");\n\nvar is_email_1 = __importDefault(require(\"./is-email\"));\n\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\n\nfunction Track(dictionary, opts) {\n  facade_1.Facade.call(this, dictionary, opts);\n}\n\nexports.Track = Track;\ninherits_1.default(Track, facade_1.Facade);\nvar t = Track.prototype;\n\nt.action = function () {\n  return \"track\";\n};\n\nt.type = t.action;\nt.event = facade_1.Facade.field(\"event\");\nt.value = facade_1.Facade.proxy(\"properties.value\");\nt.category = facade_1.Facade.proxy(\"properties.category\");\nt.id = facade_1.Facade.proxy(\"properties.id\");\n\nt.productId = function () {\n  return this.proxy(\"properties.product_id\") || this.proxy(\"properties.productId\");\n};\n\nt.promotionId = function () {\n  return this.proxy(\"properties.promotion_id\") || this.proxy(\"properties.promotionId\");\n};\n\nt.cartId = function () {\n  return this.proxy(\"properties.cart_id\") || this.proxy(\"properties.cartId\");\n};\n\nt.checkoutId = function () {\n  return this.proxy(\"properties.checkout_id\") || this.proxy(\"properties.checkoutId\");\n};\n\nt.paymentId = function () {\n  return this.proxy(\"properties.payment_id\") || this.proxy(\"properties.paymentId\");\n};\n\nt.couponId = function () {\n  return this.proxy(\"properties.coupon_id\") || this.proxy(\"properties.couponId\");\n};\n\nt.wishlistId = function () {\n  return this.proxy(\"properties.wishlist_id\") || this.proxy(\"properties.wishlistId\");\n};\n\nt.reviewId = function () {\n  return this.proxy(\"properties.review_id\") || this.proxy(\"properties.reviewId\");\n};\n\nt.orderId = function () {\n  return this.proxy(\"properties.id\") || this.proxy(\"properties.order_id\") || this.proxy(\"properties.orderId\");\n};\n\nt.sku = facade_1.Facade.proxy(\"properties.sku\");\nt.tax = facade_1.Facade.proxy(\"properties.tax\");\nt.name = facade_1.Facade.proxy(\"properties.name\");\nt.price = facade_1.Facade.proxy(\"properties.price\");\nt.total = facade_1.Facade.proxy(\"properties.total\");\nt.repeat = facade_1.Facade.proxy(\"properties.repeat\");\nt.coupon = facade_1.Facade.proxy(\"properties.coupon\");\nt.shipping = facade_1.Facade.proxy(\"properties.shipping\");\nt.discount = facade_1.Facade.proxy(\"properties.discount\");\n\nt.shippingMethod = function () {\n  return this.proxy(\"properties.shipping_method\") || this.proxy(\"properties.shippingMethod\");\n};\n\nt.paymentMethod = function () {\n  return this.proxy(\"properties.payment_method\") || this.proxy(\"properties.paymentMethod\");\n};\n\nt.description = facade_1.Facade.proxy(\"properties.description\");\nt.plan = facade_1.Facade.proxy(\"properties.plan\");\n\nt.subtotal = function () {\n  var subtotal = obj_case_1.default(this.properties(), \"subtotal\");\n  var total = this.total() || this.revenue();\n  if (subtotal) return subtotal;\n  if (!total) return 0;\n\n  if (this.total()) {\n    var n = this.tax();\n    if (n) total -= n;\n    n = this.shipping();\n    if (n) total -= n;\n    n = this.discount();\n    if (n) total += n;\n  }\n\n  return total;\n};\n\nt.products = function () {\n  var props = this.properties();\n  var products = obj_case_1.default(props, \"products\");\n\n  if (Array.isArray(products)) {\n    return products.filter(function (item) {\n      return item !== null;\n    });\n  }\n\n  return [];\n};\n\nt.quantity = function () {\n  var props = this.obj.properties || {};\n  return props.quantity || 1;\n};\n\nt.currency = function () {\n  var props = this.obj.properties || {};\n  return props.currency || \"USD\";\n};\n\nt.referrer = function () {\n  return this.proxy(\"context.referrer.url\") || this.proxy(\"context.page.referrer\") || this.proxy(\"properties.referrer\");\n};\n\nt.query = facade_1.Facade.proxy(\"options.query\");\n\nt.properties = function (aliases) {\n  var ret = this.field(\"properties\") || {};\n  aliases = aliases || {};\n\n  for (var alias in aliases) {\n    var value = this[alias] == null ? this.proxy(\"properties.\" + alias) : this[alias]();\n    if (value == null) continue;\n    ret[aliases[alias]] = value;\n    delete ret[alias];\n  }\n\n  return ret;\n};\n\nt.username = function () {\n  return this.proxy(\"traits.username\") || this.proxy(\"properties.username\") || this.userId() || this.sessionId();\n};\n\nt.email = function () {\n  var email = this.proxy(\"traits.email\") || this.proxy(\"properties.email\") || this.proxy(\"options.traits.email\");\n  if (email) return email;\n  var userId = this.userId();\n  if (is_email_1.default(userId)) return userId;\n};\n\nt.revenue = function () {\n  var revenue = this.proxy(\"properties.revenue\");\n  var event = this.event();\n  var orderCompletedRegExp = /^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i;\n\n  if (!revenue && event && event.match(orderCompletedRegExp)) {\n    revenue = this.proxy(\"properties.total\");\n  }\n\n  return currency(revenue);\n};\n\nt.cents = function () {\n  var revenue = this.revenue();\n  return typeof revenue !== \"number\" ? this.value() || 0 : revenue * 100;\n};\n\nt.identify = function () {\n  var json = this.json();\n  json.traits = this.traits();\n  return new identify_1.Identify(json, this.opts);\n};\n\nfunction currency(val) {\n  if (!val) return;\n\n  if (typeof val === \"number\") {\n    return val;\n  }\n\n  if (typeof val !== \"string\") {\n    return;\n  }\n\n  val = val.replace(/\\$/g, \"\");\n  val = parseFloat(val);\n\n  if (!isNaN(val)) {\n    return val;\n  }\n}","map":null,"metadata":{},"sourceType":"module"}