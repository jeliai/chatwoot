{"ast":null,"code":"import * as tsub from '@segment/tsub';\nexport var tsubMiddleware = function tsubMiddleware(rules) {\n  return function (_a) {\n    var payload = _a.payload,\n        integration = _a.integration,\n        next = _a.next;\n    var store = new tsub.Store(rules);\n    var rulesToApply = store.getRulesByDestinationName(integration);\n    rulesToApply.forEach(function (rule) {\n      var matchers = rule.matchers,\n          transformers = rule.transformers;\n\n      for (var i = 0; i < matchers.length; i++) {\n        if (tsub.matches(payload.obj, matchers[i])) {\n          payload.obj = tsub.transform(payload.obj, transformers[i]);\n\n          if (payload.obj === null) {\n            return next(null);\n          }\n        }\n      }\n    });\n    next(payload);\n  };\n};","map":null,"metadata":{},"sourceType":"module"}