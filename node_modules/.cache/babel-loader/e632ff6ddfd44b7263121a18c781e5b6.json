{"ast":null,"code":"var _mutations;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport \"regenerator-runtime/runtime.js\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptors.js\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]); if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport Vue from 'vue';\nimport types from '../mutation-types';\nimport authAPI from '../../api/auth';\nimport { setUser, clearCookiesOnLogout, clearLocalStorageOnLogout } from '../utils/api';\nimport { getLoginRedirectURL } from '../../helper/URLHelper';\nvar initialState = {\n  currentUser: {\n    id: null,\n    account_id: null,\n    accounts: [],\n    email: null,\n    name: null\n  },\n  uiFlags: {\n    isFetching: true\n  }\n}; // getters\n\nexport var getters = {\n  isLoggedIn: function isLoggedIn($state) {\n    return !!$state.currentUser.id;\n  },\n  getCurrentUserID: function getCurrentUserID($state) {\n    return $state.currentUser.id;\n  },\n  getUISettings: function getUISettings($state) {\n    return $state.currentUser.ui_settings || {};\n  },\n  getAuthUIFlags: function getAuthUIFlags($state) {\n    return $state.uiFlags;\n  },\n  getCurrentUserAvailability: function getCurrentUserAvailability($state, $getters) {\n    var _$state$currentUser$a = $state.currentUser.accounts,\n        accounts = _$state$currentUser$a === void 0 ? [] : _$state$currentUser$a;\n\n    var _accounts$filter = accounts.filter(function (account) {\n      return account.id === $getters.getCurrentAccountId;\n    }),\n        _accounts$filter2 = _slicedToArray(_accounts$filter, 1),\n        _accounts$filter2$ = _accounts$filter2[0],\n        currentAccount = _accounts$filter2$ === void 0 ? {} : _accounts$filter2$;\n\n    return currentAccount.availability;\n  },\n  getCurrentAccountId: function getCurrentAccountId(_, __, rootState) {\n    if (rootState.route.params && rootState.route.params.accountId) {\n      return Number(rootState.route.params.accountId);\n    }\n\n    return null;\n  },\n  getCurrentRole: function getCurrentRole($state, $getters) {\n    var _$state$currentUser$a2 = $state.currentUser.accounts,\n        accounts = _$state$currentUser$a2 === void 0 ? [] : _$state$currentUser$a2;\n\n    var _accounts$filter3 = accounts.filter(function (account) {\n      return account.id === $getters.getCurrentAccountId;\n    }),\n        _accounts$filter4 = _slicedToArray(_accounts$filter3, 1),\n        _accounts$filter4$ = _accounts$filter4[0],\n        currentAccount = _accounts$filter4$ === void 0 ? {} : _accounts$filter4$;\n\n    return currentAccount.role;\n  },\n  getCurrentUser: function getCurrentUser($state) {\n    return $state.currentUser;\n  },\n  getMessageSignature: function getMessageSignature($state) {\n    var messageSignature = $state.currentUser.message_signature;\n    return messageSignature || '';\n  },\n  getCurrentAccount: function getCurrentAccount($state, $getters) {\n    var _$state$currentUser$a3 = $state.currentUser.accounts,\n        accounts = _$state$currentUser$a3 === void 0 ? [] : _$state$currentUser$a3;\n\n    var _accounts$filter5 = accounts.filter(function (account) {\n      return account.id === $getters.getCurrentAccountId;\n    }),\n        _accounts$filter6 = _slicedToArray(_accounts$filter5, 1),\n        _accounts$filter6$ = _accounts$filter6[0],\n        currentAccount = _accounts$filter6$ === void 0 ? {} : _accounts$filter6$;\n\n    return currentAccount || {};\n  },\n  getUserAccounts: function getUserAccounts($state) {\n    var _$state$currentUser$a4 = $state.currentUser.accounts,\n        accounts = _$state$currentUser$a4 === void 0 ? [] : _$state$currentUser$a4;\n    return accounts;\n  }\n}; // actions\n\nexport var actions = {\n  login: function login(_, _ref) {\n    var ssoAccountId = _ref.ssoAccountId,\n        ssoConversationId = _ref.ssoConversationId,\n        credentials = _objectWithoutProperties(_ref, [\"ssoAccountId\", \"ssoConversationId\"]);\n\n    return new Promise(function (resolve, reject) {\n      authAPI.login(credentials).then(function (response) {\n        clearLocalStorageOnLogout();\n        window.location = getLoginRedirectURL({\n          ssoAccountId: ssoAccountId,\n          ssoConversationId: ssoConversationId,\n          user: response.data\n        });\n        resolve();\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  validityCheck: function validityCheck(context) {\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var response, currentUser, _error$response;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return authAPI.validityCheck();\n\n            case 3:\n              response = _context.sent;\n              currentUser = response.data.payload.data;\n              setUser(currentUser);\n              context.commit(types.SET_CURRENT_USER, currentUser);\n              _context.next = 12;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n\n              if ((_context.t0 === null || _context.t0 === void 0 ? void 0 : (_error$response = _context.t0.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n                clearCookiesOnLogout();\n              }\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 9]]);\n    }))();\n  },\n  setUser: function setUser(_ref2) {\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n      var commit, dispatch;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              commit = _ref2.commit, dispatch = _ref2.dispatch;\n\n              if (!authAPI.hasAuthCookie()) {\n                _context2.next = 6;\n                break;\n              }\n\n              _context2.next = 4;\n              return dispatch('validityCheck');\n\n            case 4:\n              _context2.next = 7;\n              break;\n\n            case 6:\n              commit(types.CLEAR_USER);\n\n            case 7:\n              commit(types.SET_CURRENT_USER_UI_FLAGS, {\n                isFetching: false\n              });\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }))();\n  },\n  logout: function logout(_ref3) {\n    var commit = _ref3.commit;\n    commit(types.CLEAR_USER);\n  },\n  updateProfile: function () {\n    var _updateProfile = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(_ref4, params) {\n      var commit, response;\n      return regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              commit = _ref4.commit;\n              _context3.prev = 1;\n              _context3.next = 4;\n              return authAPI.profileUpdate(params);\n\n            case 4:\n              response = _context3.sent;\n              commit(types.SET_CURRENT_USER, response.data);\n              _context3.next = 11;\n              break;\n\n            case 8:\n              _context3.prev = 8;\n              _context3.t0 = _context3[\"catch\"](1);\n              throw _context3.t0;\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 8]]);\n    }));\n\n    function updateProfile(_x, _x2) {\n      return _updateProfile.apply(this, arguments);\n    }\n\n    return updateProfile;\n  }(),\n  deleteAvatar: function () {\n    var _deleteAvatar = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n      return regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return authAPI.deleteAvatar();\n\n            case 3:\n              _context4.next = 7;\n              break;\n\n            case 5:\n              _context4.prev = 5;\n              _context4.t0 = _context4[\"catch\"](0);\n\n            case 7:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 5]]);\n    }));\n\n    function deleteAvatar() {\n      return _deleteAvatar.apply(this, arguments);\n    }\n\n    return deleteAvatar;\n  }(),\n  updateUISettings: function () {\n    var _updateUISettings = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5(_ref5, params) {\n      var commit, response;\n      return regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              commit = _ref5.commit;\n              _context5.prev = 1;\n              commit(types.SET_CURRENT_USER_UI_SETTINGS, params);\n              _context5.next = 5;\n              return authAPI.updateUISettings(params);\n\n            case 5:\n              response = _context5.sent;\n              commit(types.SET_CURRENT_USER, response.data);\n              _context5.next = 11;\n              break;\n\n            case 9:\n              _context5.prev = 9;\n              _context5.t0 = _context5[\"catch\"](1);\n\n            case 11:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[1, 9]]);\n    }));\n\n    function updateUISettings(_x3, _x4) {\n      return _updateUISettings.apply(this, arguments);\n    }\n\n    return updateUISettings;\n  }(),\n  updateAvailability: function () {\n    var _updateAvailability = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6(_ref6, params) {\n      var commit, dispatch, response, userData, id;\n      return regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              commit = _ref6.commit, dispatch = _ref6.dispatch;\n              _context6.prev = 1;\n              _context6.next = 4;\n              return authAPI.updateAvailability(params);\n\n            case 4:\n              response = _context6.sent;\n              userData = response.data;\n              id = userData.id;\n              commit(types.SET_CURRENT_USER, response.data);\n              dispatch('agents/updateSingleAgentPresence', {\n                id: id,\n                availabilityStatus: params.availability\n              });\n              _context6.next = 13;\n              break;\n\n            case 11:\n              _context6.prev = 11;\n              _context6.t0 = _context6[\"catch\"](1);\n\n            case 13:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, null, [[1, 11]]);\n    }));\n\n    function updateAvailability(_x5, _x6) {\n      return _updateAvailability.apply(this, arguments);\n    }\n\n    return updateAvailability;\n  }(),\n  setCurrentUserAvailability: function setCurrentUserAvailability(_ref7, data) {\n    var commit = _ref7.commit,\n        $state = _ref7.state;\n\n    if (data[$state.currentUser.id]) {\n      commit(types.SET_CURRENT_USER_AVAILABILITY, data[$state.currentUser.id]);\n    }\n  },\n  setActiveAccount: function () {\n    var _setActiveAccount = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7(_, _ref8) {\n      var accountId;\n      return regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              accountId = _ref8.accountId;\n              _context7.prev = 1;\n              _context7.next = 4;\n              return authAPI.setActiveAccount({\n                accountId: accountId\n              });\n\n            case 4:\n              _context7.next = 8;\n              break;\n\n            case 6:\n              _context7.prev = 6;\n              _context7.t0 = _context7[\"catch\"](1);\n\n            case 8:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, null, [[1, 6]]);\n    }));\n\n    function setActiveAccount(_x7, _x8) {\n      return _setActiveAccount.apply(this, arguments);\n    }\n\n    return setActiveAccount;\n  }()\n}; // mutations\n\nexport var mutations = (_mutations = {}, _defineProperty(_mutations, types.SET_CURRENT_USER_AVAILABILITY, function (_state, availability) {\n  Vue.set(_state.currentUser, 'availability', availability);\n}), _defineProperty(_mutations, types.CLEAR_USER, function (_state) {\n  _state.currentUser = initialState.currentUser;\n}), _defineProperty(_mutations, types.SET_CURRENT_USER, function (_state, currentUser) {\n  Vue.set(_state, 'currentUser', currentUser);\n}), _defineProperty(_mutations, types.SET_CURRENT_USER_UI_SETTINGS, function (_state, _ref9) {\n  var uiSettings = _ref9.uiSettings;\n  Vue.set(_state, 'currentUser', _objectSpread(_objectSpread({}, _state.currentUser), {}, {\n    ui_settings: _objectSpread(_objectSpread({}, _state.currentUser.ui_settings), uiSettings)\n  }));\n}), _defineProperty(_mutations, types.SET_CURRENT_USER_UI_FLAGS, function (_state, _ref10) {\n  var isFetching = _ref10.isFetching;\n  Vue.set(_state, 'uiFlags', {\n    isFetching: isFetching\n  });\n}), _mutations);\nexport default {\n  state: initialState,\n  getters: getters,\n  actions: actions,\n  mutations: mutations\n};","map":{"version":3,"sources":["/Users/s.dastan/Desktop/chatwoot/chatwoot/app/javascript/dashboard/store/modules/auth.js"],"names":["Vue","types","authAPI","setUser","clearCookiesOnLogout","clearLocalStorageOnLogout","getLoginRedirectURL","initialState","currentUser","id","account_id","accounts","email","name","uiFlags","isFetching","getters","isLoggedIn","$state","getCurrentUserID","getUISettings","ui_settings","getAuthUIFlags","getCurrentUserAvailability","$getters","filter","account","getCurrentAccountId","currentAccount","availability","_","__","rootState","route","params","accountId","Number","getCurrentRole","role","getCurrentUser","getMessageSignature","messageSignature","message_signature","getCurrentAccount","getUserAccounts","actions","login","ssoAccountId","ssoConversationId","credentials","Promise","resolve","reject","then","response","window","location","user","data","catch","error","validityCheck","context","payload","commit","SET_CURRENT_USER","status","dispatch","hasAuthCookie","CLEAR_USER","SET_CURRENT_USER_UI_FLAGS","logout","updateProfile","profileUpdate","deleteAvatar","updateUISettings","SET_CURRENT_USER_UI_SETTINGS","updateAvailability","userData","availabilityStatus","setCurrentUserAvailability","state","SET_CURRENT_USER_AVAILABILITY","setActiveAccount","mutations","_state","set","uiSettings"],"mappings":"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","sourcesContent":["import Vue from 'vue';\nimport types from '../mutation-types';\nimport authAPI from '../../api/auth';\n\nimport {\n  setUser,\n  clearCookiesOnLogout,\n  clearLocalStorageOnLogout,\n} from '../utils/api';\nimport { getLoginRedirectURL } from '../../helper/URLHelper';\n\nconst initialState = {\n  currentUser: {\n    id: null,\n    account_id: null,\n    accounts: [],\n    email: null,\n    name: null,\n  },\n  uiFlags: {\n    isFetching: true,\n  },\n};\n\n// getters\nexport const getters = {\n  isLoggedIn($state) {\n    return !!$state.currentUser.id;\n  },\n\n  getCurrentUserID($state) {\n    return $state.currentUser.id;\n  },\n\n  getUISettings($state) {\n    return $state.currentUser.ui_settings || {};\n  },\n\n  getAuthUIFlags($state) {\n    return $state.uiFlags;\n  },\n\n  getCurrentUserAvailability($state, $getters) {\n    const { accounts = [] } = $state.currentUser;\n    const [currentAccount = {}] = accounts.filter(\n      account => account.id === $getters.getCurrentAccountId\n    );\n    return currentAccount.availability;\n  },\n\n  getCurrentAccountId(_, __, rootState) {\n    if (rootState.route.params && rootState.route.params.accountId) {\n      return Number(rootState.route.params.accountId);\n    }\n    return null;\n  },\n\n  getCurrentRole($state, $getters) {\n    const { accounts = [] } = $state.currentUser;\n    const [currentAccount = {}] = accounts.filter(\n      account => account.id === $getters.getCurrentAccountId\n    );\n    return currentAccount.role;\n  },\n\n  getCurrentUser($state) {\n    return $state.currentUser;\n  },\n\n  getMessageSignature($state) {\n    const { message_signature: messageSignature } = $state.currentUser;\n\n    return messageSignature || '';\n  },\n\n  getCurrentAccount($state, $getters) {\n    const { accounts = [] } = $state.currentUser;\n    const [currentAccount = {}] = accounts.filter(\n      account => account.id === $getters.getCurrentAccountId\n    );\n    return currentAccount || {};\n  },\n\n  getUserAccounts($state) {\n    const { accounts = [] } = $state.currentUser;\n    return accounts;\n  },\n};\n\n// actions\nexport const actions = {\n  login(_, { ssoAccountId, ssoConversationId, ...credentials }) {\n    return new Promise((resolve, reject) => {\n      authAPI\n        .login(credentials)\n        .then(response => {\n          clearLocalStorageOnLogout();\n          window.location = getLoginRedirectURL({\n            ssoAccountId,\n            ssoConversationId,\n            user: response.data,\n          });\n          resolve();\n        })\n        .catch(error => {\n          reject(error);\n        });\n    });\n  },\n  async validityCheck(context) {\n    try {\n      const response = await authAPI.validityCheck();\n      const currentUser = response.data.payload.data;\n      setUser(currentUser);\n      context.commit(types.SET_CURRENT_USER, currentUser);\n    } catch (error) {\n      if (error?.response?.status === 401) {\n        clearCookiesOnLogout();\n      }\n    }\n  },\n  async setUser({ commit, dispatch }) {\n    if (authAPI.hasAuthCookie()) {\n      await dispatch('validityCheck');\n    } else {\n      commit(types.CLEAR_USER);\n    }\n    commit(types.SET_CURRENT_USER_UI_FLAGS, { isFetching: false });\n  },\n  logout({ commit }) {\n    commit(types.CLEAR_USER);\n  },\n\n  updateProfile: async ({ commit }, params) => {\n    // eslint-disable-next-line no-useless-catch\n    try {\n      const response = await authAPI.profileUpdate(params);\n      commit(types.SET_CURRENT_USER, response.data);\n    } catch (error) {\n      throw error;\n    }\n  },\n\n  deleteAvatar: async () => {\n    try {\n      await authAPI.deleteAvatar();\n    } catch (error) {\n      // Ignore error\n    }\n  },\n\n  updateUISettings: async ({ commit }, params) => {\n    try {\n      commit(types.SET_CURRENT_USER_UI_SETTINGS, params);\n      const response = await authAPI.updateUISettings(params);\n      commit(types.SET_CURRENT_USER, response.data);\n    } catch (error) {\n      // Ignore error\n    }\n  },\n\n  updateAvailability: async ({ commit, dispatch }, params) => {\n    try {\n      const response = await authAPI.updateAvailability(params);\n      const userData = response.data;\n      const { id } = userData;\n      commit(types.SET_CURRENT_USER, response.data);\n      dispatch('agents/updateSingleAgentPresence', {\n        id,\n        availabilityStatus: params.availability,\n      });\n    } catch (error) {\n      // Ignore error\n    }\n  },\n\n  setCurrentUserAvailability({ commit, state: $state }, data) {\n    if (data[$state.currentUser.id]) {\n      commit(types.SET_CURRENT_USER_AVAILABILITY, data[$state.currentUser.id]);\n    }\n  },\n\n  setActiveAccount: async (_, { accountId }) => {\n    try {\n      await authAPI.setActiveAccount({ accountId });\n    } catch (error) {\n      // Ignore error\n    }\n  },\n};\n\n// mutations\nexport const mutations = {\n  [types.SET_CURRENT_USER_AVAILABILITY](_state, availability) {\n    Vue.set(_state.currentUser, 'availability', availability);\n  },\n  [types.CLEAR_USER](_state) {\n    _state.currentUser = initialState.currentUser;\n  },\n  [types.SET_CURRENT_USER](_state, currentUser) {\n    Vue.set(_state, 'currentUser', currentUser);\n  },\n  [types.SET_CURRENT_USER_UI_SETTINGS](_state, { uiSettings }) {\n    Vue.set(_state, 'currentUser', {\n      ..._state.currentUser,\n      ui_settings: {\n        ..._state.currentUser.ui_settings,\n        ...uiSettings,\n      },\n    });\n  },\n\n  [types.SET_CURRENT_USER_UI_FLAGS](_state, { isFetching }) {\n    Vue.set(_state, 'uiFlags', { isFetching });\n  },\n};\n\nexport default {\n  state: initialState,\n  getters,\n  actions,\n  mutations,\n};\n"]},"metadata":{},"sourceType":"module"}