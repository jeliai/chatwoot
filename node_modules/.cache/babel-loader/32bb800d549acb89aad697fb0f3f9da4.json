{"ast":null,"code":"/* eslint-disable no-plusplus */\nvar prefix = 'ProseMirror-prompt';\n\nfunction reportInvalid(dom, message) {\n  // FIXME this is awful and needs a lot more work\n  var parent = dom.parentNode;\n  var msg = parent.appendChild(document.createElement('div'));\n  msg.style.left = dom.offsetLeft + dom.offsetWidth + 2 + 'px';\n  msg.style.top = dom.offsetTop - 5 + 'px';\n  msg.className = 'ProseMirror-invalid';\n  msg.textContent = message;\n  setTimeout(function () {\n    return parent.removeChild(msg);\n  }, 1500);\n}\n\nfunction getValues(fields, domFields) {\n  var result = Object.keys(fields).filter(function (name, index) {\n    var field = fields[name];\n    var dom = domFields[index];\n    var value = field.read(dom);\n    var bad = field.validate(value);\n    if (bad) reportInvalid(dom, bad);\n    return !bad;\n  }).reduce(function (acc, name, index) {\n    var field = fields[name];\n    var dom = domFields[index];\n    var value = field.read(dom);\n    acc[name] = field.clean(value);\n    return acc;\n  }, {});\n  return result;\n}\n\nexport function openPrompt(options) {\n  var wrapper = document.body.appendChild(document.createElement('div'));\n  wrapper.className = prefix;\n\n  var close = function close() {\n    // eslint-disable-next-line no-use-before-define\n    window.removeEventListener('mousedown', mouseOutside);\n    if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);\n  };\n\n  var mouseOutside = function mouseOutside(e) {\n    if (!wrapper.contains(e.target)) close();\n  };\n\n  setTimeout(function () {\n    return window.addEventListener('mousedown', mouseOutside);\n  }, 50);\n  var domFields = [];\n  Object.values(options.fields).map(function (field) {\n    return domFields.push(field.render());\n  });\n  var submitButton = document.createElement('button');\n  submitButton.type = 'submit';\n  submitButton.className = 'button tiny button--save-link ' + prefix + '-submit';\n  submitButton.textContent = 'Create Link';\n  var cancelButton = document.createElement('button');\n  cancelButton.type = 'button';\n  cancelButton.className = 'button tiny hollow secondary' + prefix + '-cancel';\n  cancelButton.textContent = 'Cancel';\n  cancelButton.addEventListener('click', close);\n  var form = wrapper.appendChild(document.createElement('form'));\n\n  if (options.title) {\n    var titleDom = document.createElement('h5');\n    titleDom.className = 'sub-block-title';\n    form.appendChild(titleDom).textContent = options.title;\n  }\n\n  domFields.forEach(function (field) {\n    form.appendChild(document.createElement('div')).appendChild(field);\n  });\n  var buttons = form.appendChild(document.createElement('div'));\n  buttons.className = prefix + '-buttons';\n  buttons.appendChild(submitButton);\n  buttons.appendChild(document.createTextNode(' '));\n  buttons.appendChild(cancelButton);\n  var box = wrapper.getBoundingClientRect();\n  wrapper.style.top = (window.innerHeight - box.height) / 2 + 'px';\n  wrapper.style.left = (window.innerWidth - box.width) / 2 + 'px';\n\n  var submit = function submit() {\n    var params = getValues(options.fields, domFields);\n\n    if (params) {\n      close();\n      options.callback(params);\n    }\n  };\n\n  form.addEventListener('submit', function (e) {\n    e.preventDefault();\n    submit();\n  });\n  form.addEventListener('keydown', function (e) {\n    if (e.key === 'Esc') {\n      e.preventDefault();\n      close();\n    } else if (e.key === 'Enter' && !(e.ctrlKey || e.metaKey || e.shiftKey)) {\n      e.preventDefault();\n      submit();\n    } else if (e.key === 'Tab') {\n      window.setTimeout(function () {\n        if (!wrapper.contains(document.activeElement)) close();\n      }, 500);\n    }\n  });\n  var input = form.elements[0];\n  if (input) input.focus();\n}","map":null,"metadata":{},"sourceType":"module"}