{"ast":null,"code":"import \"regenerator-runtime/runtime.js\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/* global FB */\nimport SettingsSection from '../../../../../components/SettingsSection';\nimport alertMixin from 'shared/mixins/alertMixin';\nexport default {\n  components: {\n    SettingsSection: SettingsSection\n  },\n  mixins: [alertMixin],\n  props: {\n    inboxId: {\n      type: Number,\n      required: true\n    }\n  },\n  mounted: function mounted() {\n    this.initFB();\n    this.loadFBsdk();\n  },\n  methods: {\n    initFB: function initFB() {\n      if (window.fbSDKLoaded === undefined) {\n        window.fbAsyncInit = function () {\n          FB.init({\n            appId: window.chatwootConfig.fbAppId,\n            xfbml: true,\n            version: window.chatwootConfig.fbApiVersion,\n            status: true\n          });\n          window.fbSDKLoaded = true;\n          FB.AppEvents.logPageView();\n        };\n      }\n    },\n    loadFBsdk: function loadFBsdk() {\n      (function (d, s, id) {\n        var js; // eslint-disable-next-line\n\n        var fjs = js = d.getElementsByTagName(s)[0];\n\n        if (d.getElementById(id)) {\n          return;\n        }\n\n        js = d.createElement(s);\n        js.id = id;\n        js.src = 'https://connect.facebook.net/en_US/sdk.js';\n        fjs.parentNode.insertBefore(js, fjs);\n      })(document, 'script', 'facebook-jssdk');\n    },\n    tryFBlogin: function tryFBlogin() {\n      var _this = this;\n\n      FB.login(function (response) {\n        if (response.status === 'connected') {\n          _this.reauthorizeFBPage(response.authResponse.accessToken);\n        } else if (response.status === 'not_authorized') {\n          // The person is logged into Facebook, but not your app.\n          _this.showAlert(_this.$t('INBOX_MGMT.DETAILS.ERROR_FB_AUTH'));\n        } else {\n          // The person is not logged into Facebook, so we're not sure if\n          // they are logged into this app or not.\n          _this.showAlert(_this.$t('INBOX_MGMT.DETAILS.ERROR_FB_AUTH'));\n        }\n      }, {\n        scope: 'pages_manage_metadata,pages_messaging,instagram_basic,pages_show_list,pages_read_engagement,instagram_manage_messages',\n        auth_type: 'reauthorize'\n      });\n    },\n    reauthorizeFBPage: function reauthorizeFBPage(omniauthToken) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return _this2.$store.dispatch('inboxes/reauthorizeFacebookPage', {\n                  omniauthToken: omniauthToken,\n                  inboxId: _this2.inboxId\n                });\n\n              case 3:\n                _this2.showAlert(_this2.$t('INBOX_MGMT.FACEBOOK_REAUTHORIZE.MESSAGE_SUCCESS'));\n\n                _context.next = 9;\n                break;\n\n              case 6:\n                _context.prev = 6;\n                _context.t0 = _context[\"catch\"](0);\n\n                _this2.showAlert(_this2.$t('INBOX_MGMT.FACEBOOK_REAUTHORIZE.MESSAGE_ERROR'));\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 6]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"sources":["Reauthorize.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <settings-section\n    :title=\"$t('INBOX_MGMT.FACEBOOK_REAUTHORIZE.TITLE')\"\n    :sub-title=\"$t('INBOX_MGMT.FACEBOOK_REAUTHORIZE.SUBTITLE')\"\n  >\n    <a class=\"fb--login\" href=\"#\" @click=\"tryFBlogin\">\n      <img\n        src=\"~dashboard/assets/images/channels/facebook_login.png\"\n        alt=\"Facebook-logo\"\n      />\n    </a>\n  </settings-section>\n</template>\n\n<script>\n/* global FB */\nimport SettingsSection from '../../../../../components/SettingsSection';\nimport alertMixin from 'shared/mixins/alertMixin';\n\nexport default {\n  components: {\n    SettingsSection,\n  },\n  mixins: [alertMixin],\n  props: {\n    inboxId: {\n      type: Number,\n      required: true,\n    },\n  },\n  mounted() {\n    this.initFB();\n    this.loadFBsdk();\n  },\n\n  methods: {\n    initFB() {\n      if (window.fbSDKLoaded === undefined) {\n        window.fbAsyncInit = () => {\n          FB.init({\n            appId: window.chatwootConfig.fbAppId,\n            xfbml: true,\n            version: window.chatwootConfig.fbApiVersion,\n            status: true,\n          });\n          window.fbSDKLoaded = true;\n          FB.AppEvents.logPageView();\n        };\n      }\n    },\n\n    loadFBsdk() {\n      ((d, s, id) => {\n        let js;\n        // eslint-disable-next-line\n        const fjs = (js = d.getElementsByTagName(s)[0]);\n        if (d.getElementById(id)) {\n          return;\n        }\n        js = d.createElement(s);\n        js.id = id;\n        js.src = 'https://connect.facebook.net/en_US/sdk.js';\n        fjs.parentNode.insertBefore(js, fjs);\n      })(document, 'script', 'facebook-jssdk');\n    },\n\n    tryFBlogin() {\n      FB.login(\n        response => {\n          if (response.status === 'connected') {\n            this.reauthorizeFBPage(response.authResponse.accessToken);\n          } else if (response.status === 'not_authorized') {\n            // The person is logged into Facebook, but not your app.\n            this.showAlert(this.$t('INBOX_MGMT.DETAILS.ERROR_FB_AUTH'));\n          } else {\n            // The person is not logged into Facebook, so we're not sure if\n            // they are logged into this app or not.\n            this.showAlert(this.$t('INBOX_MGMT.DETAILS.ERROR_FB_AUTH'));\n          }\n        },\n        {\n          scope:\n            'pages_manage_metadata,pages_messaging,instagram_basic,pages_show_list,pages_read_engagement,instagram_manage_messages',\n          auth_type: 'reauthorize',\n        }\n      );\n    },\n    async reauthorizeFBPage(omniauthToken) {\n      try {\n        await this.$store.dispatch('inboxes/reauthorizeFacebookPage', {\n          omniauthToken,\n          inboxId: this.inboxId,\n        });\n        this.showAlert(\n          this.$t('INBOX_MGMT.FACEBOOK_REAUTHORIZE.MESSAGE_SUCCESS')\n        );\n      } catch (error) {\n        this.showAlert(\n          this.$t('INBOX_MGMT.FACEBOOK_REAUTHORIZE.MESSAGE_ERROR')\n        );\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import '~dashboard/assets/scss/variables';\n\n.fb--login {\n  img {\n    max-width: 240px;\n    padding: $space-normal 0;\n  }\n}\n</style>\n"],"sourceRoot":"app/javascript/dashboard/routes/dashboard/settings/inbox/facebook"},"metadata":{},"sourceType":"module"}