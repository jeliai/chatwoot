{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Facade = void 0;\n\nvar address_1 = __importDefault(require(\"./address\"));\n\nvar lite_1 = require(\"klona/lite\");\n\nvar is_enabled_1 = __importDefault(require(\"./is-enabled\"));\n\nvar new_date_1 = __importDefault(require(\"new-date\"));\n\nvar obj_case_1 = __importDefault(require(\"obj-case\"));\n\nvar isodate_traverse_1 = __importDefault(require(\"@segment/isodate-traverse\"));\n\nfunction Facade(obj, opts) {\n  opts = opts || {};\n  this.raw = lite_1.klona(obj);\n  if (!(\"clone\" in opts)) opts.clone = true;\n  if (opts.clone) obj = lite_1.klona(obj);\n  if (!(\"traverse\" in opts)) opts.traverse = true;\n  if (!(\"timestamp\" in obj)) obj.timestamp = new Date();else obj.timestamp = new_date_1.default(obj.timestamp);\n  if (opts.traverse) isodate_traverse_1.default(obj);\n  this.opts = opts;\n  this.obj = obj;\n}\n\nexports.Facade = Facade;\nvar f = Facade.prototype;\n\nf.proxy = function (field) {\n  var fields = field.split(\".\");\n  field = fields.shift();\n  var obj = this[field] || this.field(field);\n  if (!obj) return obj;\n  if (typeof obj === \"function\") obj = obj.call(this) || {};\n  if (fields.length === 0) return this.opts.clone ? transform(obj) : obj;\n  obj = obj_case_1.default(obj, fields.join(\".\"));\n  return this.opts.clone ? transform(obj) : obj;\n};\n\nf.field = function (field) {\n  var obj = this.obj[field];\n  return this.opts.clone ? transform(obj) : obj;\n};\n\nFacade.proxy = function (field) {\n  return function () {\n    return this.proxy(field);\n  };\n};\n\nFacade.field = function (field) {\n  return function () {\n    return this.field(field);\n  };\n};\n\nFacade.multi = function (path) {\n  return function () {\n    var multi = this.proxy(path + \"s\");\n    if (Array.isArray(multi)) return multi;\n    var one = this.proxy(path);\n    if (one) one = [this.opts.clone ? lite_1.klona(one) : one];\n    return one || [];\n  };\n};\n\nFacade.one = function (path) {\n  return function () {\n    var one = this.proxy(path);\n    if (one) return one;\n    var multi = this.proxy(path + \"s\");\n    if (Array.isArray(multi)) return multi[0];\n  };\n};\n\nf.json = function () {\n  var ret = this.opts.clone ? lite_1.klona(this.obj) : this.obj;\n  if (this.type) ret.type = this.type();\n  return ret;\n};\n\nf.rawEvent = function () {\n  return this.raw;\n};\n\nf.options = function (integration) {\n  var obj = this.obj.options || this.obj.context || {};\n  var options = this.opts.clone ? lite_1.klona(obj) : obj;\n  if (!integration) return options;\n  if (!this.enabled(integration)) return;\n  var integrations = this.integrations();\n  var value = integrations[integration] || obj_case_1.default(integrations, integration);\n  if (_typeof(value) !== \"object\") value = obj_case_1.default(this.options(), integration);\n  return _typeof(value) === \"object\" ? value : {};\n};\n\nf.context = f.options;\n\nf.enabled = function (integration) {\n  var allEnabled = this.proxy(\"options.providers.all\");\n  if (typeof allEnabled !== \"boolean\") allEnabled = this.proxy(\"options.all\");\n  if (typeof allEnabled !== \"boolean\") allEnabled = this.proxy(\"integrations.all\");\n  if (typeof allEnabled !== \"boolean\") allEnabled = true;\n  var enabled = allEnabled && is_enabled_1.default(integration);\n  var options = this.integrations();\n\n  if (options.providers && options.providers.hasOwnProperty(integration)) {\n    enabled = options.providers[integration];\n  }\n\n  if (options.hasOwnProperty(integration)) {\n    var settings = options[integration];\n\n    if (typeof settings === \"boolean\") {\n      enabled = settings;\n    } else {\n      enabled = true;\n    }\n  }\n\n  return !!enabled;\n};\n\nf.integrations = function () {\n  return this.obj.integrations || this.proxy(\"options.providers\") || this.options();\n};\n\nf.active = function () {\n  var active = this.proxy(\"options.active\");\n  if (active === null || active === undefined) active = true;\n  return active;\n};\n\nf.anonymousId = function () {\n  return this.field(\"anonymousId\") || this.field(\"sessionId\");\n};\n\nf.sessionId = f.anonymousId;\nf.groupId = Facade.proxy(\"options.groupId\");\n\nf.traits = function (aliases) {\n  var ret = this.proxy(\"options.traits\") || {};\n  var id = this.userId();\n  aliases = aliases || {};\n  if (id) ret.id = id;\n\n  for (var alias in aliases) {\n    var value = this[alias] == null ? this.proxy(\"options.traits.\" + alias) : this[alias]();\n    if (value == null) continue;\n    ret[aliases[alias]] = value;\n    delete ret[alias];\n  }\n\n  return ret;\n};\n\nf.library = function () {\n  var library = this.proxy(\"options.library\");\n  if (!library) return {\n    name: \"unknown\",\n    version: null\n  };\n  if (typeof library === \"string\") return {\n    name: library,\n    version: null\n  };\n  return library;\n};\n\nf.device = function () {\n  var device = this.proxy(\"context.device\");\n\n  if (_typeof(device) !== \"object\" || device === null) {\n    device = {};\n  }\n\n  var library = this.library().name;\n  if (device.type) return device;\n  if (library.indexOf(\"ios\") > -1) device.type = \"ios\";\n  if (library.indexOf(\"android\") > -1) device.type = \"android\";\n  return device;\n};\n\nf.userAgent = Facade.proxy(\"context.userAgent\");\nf.timezone = Facade.proxy(\"context.timezone\");\nf.timestamp = Facade.field(\"timestamp\");\nf.channel = Facade.field(\"channel\");\nf.ip = Facade.proxy(\"context.ip\");\nf.userId = Facade.field(\"userId\");\naddress_1.default(f);\n\nfunction transform(obj) {\n  return lite_1.klona(obj);\n}","map":null,"metadata":{},"sourceType":"module"}