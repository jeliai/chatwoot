{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"regenerator-runtime/runtime.js\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Branding from 'shared/components/Branding';\nimport Spinner from 'shared/components/Spinner';\nimport Rating from 'survey/components/Rating';\nimport Feedback from 'survey/components/Feedback';\nimport Banner from 'survey/components/Banner';\nimport configMixin from 'shared/mixins/configMixin';\nimport { getSurveyDetails as _getSurveyDetails, updateSurvey } from 'survey/api/survey';\nimport alertMixin from 'shared/mixins/alertMixin';\nexport default {\n  name: 'Response',\n  components: {\n    Branding: Branding,\n    Rating: Rating,\n    Spinner: Spinner,\n    Banner: Banner,\n    Feedback: Feedback\n  },\n  mixins: [alertMixin, configMixin],\n  props: {\n    showHomePage: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      surveyDetails: null,\n      isLoading: false,\n      errorMessage: null,\n      selectedRating: null,\n      feedbackMessage: '',\n      isUpdating: false,\n      logo: '',\n      inboxName: ''\n    };\n  },\n  computed: {\n    surveyId: function surveyId() {\n      var pageURL = window.location.href;\n      return pageURL.substring(pageURL.lastIndexOf('/') + 1);\n    },\n    isRatingSubmitted: function isRatingSubmitted() {\n      return this.surveyDetails && this.surveyDetails.rating;\n    },\n    isFeedbackSubmitted: function isFeedbackSubmitted() {\n      return this.surveyDetails && this.surveyDetails.feedback_message;\n    },\n    isButtonDisabled: function isButtonDisabled() {\n      return !(this.selectedRating && this.feedback);\n    },\n    shouldShowBanner: function shouldShowBanner() {\n      return this.isRatingSubmitted || this.errorMessage;\n    },\n    enableFeedbackForm: function enableFeedbackForm() {\n      return !this.isFeedbackSubmitted && this.isRatingSubmitted;\n    },\n    shouldShowErrorMesage: function shouldShowErrorMesage() {\n      return !!this.errorMessage;\n    },\n    shouldShowSuccessMesage: function shouldShowSuccessMesage() {\n      return !!this.isRatingSubmitted;\n    },\n    message: function message() {\n      if (this.errorMessage) {\n        return this.errorMessage;\n      }\n\n      return this.$t('SURVEY.RATING.SUCCESS_MESSAGE');\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.getSurveyDetails();\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    selectRating: function selectRating(rating) {\n      this.selectedRating = rating;\n      this.updateSurveyDetails();\n    },\n    sendFeedback: function sendFeedback(message) {\n      this.feedbackMessage = message;\n      this.updateSurveyDetails();\n    },\n    getSurveyDetails: function getSurveyDetails() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _result$data, _this2$surveyDetails, _this2$surveyDetails2, result, _error$response, _error$response$data, errorMessage;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this2.isLoading = true;\n                _context2.prev = 1;\n                _context2.next = 4;\n                return _getSurveyDetails({\n                  uuid: _this2.surveyId\n                });\n\n              case 4:\n                result = _context2.sent;\n                _this2.logo = result.data.inbox_avatar_url;\n                _this2.inboxName = result.data.inbox_name;\n                _this2.surveyDetails = result === null || result === void 0 ? void 0 : (_result$data = result.data) === null || _result$data === void 0 ? void 0 : _result$data.csat_survey_response;\n                _this2.selectedRating = (_this2$surveyDetails = _this2.surveyDetails) === null || _this2$surveyDetails === void 0 ? void 0 : _this2$surveyDetails.rating;\n                _this2.feedbackMessage = ((_this2$surveyDetails2 = _this2.surveyDetails) === null || _this2$surveyDetails2 === void 0 ? void 0 : _this2$surveyDetails2.feedback_message) || '';\n\n                _this2.setLocale(result.data.locale);\n\n                _context2.next = 17;\n                break;\n\n              case 13:\n                _context2.prev = 13;\n                _context2.t0 = _context2[\"catch\"](1);\n                errorMessage = _context2.t0 === null || _context2.t0 === void 0 ? void 0 : (_error$response = _context2.t0.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message;\n                _this2.errorMessage = errorMessage || _this2.$t('SURVEY.API.ERROR_MESSAGE');\n\n              case 17:\n                _context2.prev = 17;\n                _this2.isLoading = false;\n                return _context2.finish(17);\n\n              case 20:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[1, 13, 17, 20]]);\n      }))();\n    },\n    updateSurveyDetails: function updateSurveyDetails() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var data, _error$response2, _error$response2$data, errorMessage;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this3.isUpdating = true;\n                _context3.prev = 1;\n                data = {\n                  message: {\n                    submitted_values: {\n                      csat_survey_response: {\n                        rating: _this3.selectedRating,\n                        feedback_message: _this3.feedbackMessage\n                      }\n                    }\n                  }\n                };\n                _context3.next = 5;\n                return updateSurvey({\n                  uuid: _this3.surveyId,\n                  data: data\n                });\n\n              case 5:\n                _this3.surveyDetails = {\n                  rating: _this3.selectedRating,\n                  feedback_message: _this3.feedbackMessage\n                };\n                _context3.next = 12;\n                break;\n\n              case 8:\n                _context3.prev = 8;\n                _context3.t0 = _context3[\"catch\"](1);\n                errorMessage = _context3.t0 === null || _context3.t0 === void 0 ? void 0 : (_error$response2 = _context3.t0.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message;\n                _this3.errorMessage = errorMessage || _this3.$t('SURVEY.API.ERROR_MESSAGE');\n\n              case 12:\n                _context3.prev = 12;\n                _this3.isUpdating = false;\n                return _context3.finish(12);\n\n              case 15:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[1, 8, 12, 15]]);\n      }))();\n    },\n    setLocale: function setLocale(locale) {\n      this.$root.$i18n.locale = locale || 'en';\n    }\n  }\n};","map":{"version":3,"sources":["Response.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDA,OAAA,QAAA,MAAA,4BAAA;AACA,OAAA,OAAA,MAAA,2BAAA;AACA,OAAA,MAAA,MAAA,0BAAA;AACA,OAAA,QAAA,MAAA,4BAAA;AACA,OAAA,MAAA,MAAA,0BAAA;AACA,OAAA,WAAA,MAAA,2BAAA;AACA,SAAA,gBAAA,IAAA,iBAAA,EAAA,YAAA,QAAA,mBAAA;AACA,OAAA,UAAA,MAAA,0BAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,UADA;AAEA,EAAA,UAAA,EAAA;AACA,IAAA,QAAA,EAAA,QADA;AAEA,IAAA,MAAA,EAAA,MAFA;AAGA,IAAA,OAAA,EAAA,OAHA;AAIA,IAAA,MAAA,EAAA,MAJA;AAKA,IAAA,QAAA,EAAA;AALA,GAFA;AASA,EAAA,MAAA,EAAA,CAAA,UAAA,EAAA,WAAA,CATA;AAUA,EAAA,KAAA,EAAA;AACA,IAAA,YAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA;AADA,GAVA;AAiBA,EAAA,IAjBA,kBAiBA;AACA,WAAA;AACA,MAAA,aAAA,EAAA,IADA;AAEA,MAAA,SAAA,EAAA,KAFA;AAGA,MAAA,YAAA,EAAA,IAHA;AAIA,MAAA,cAAA,EAAA,IAJA;AAKA,MAAA,eAAA,EAAA,EALA;AAMA,MAAA,UAAA,EAAA,KANA;AAOA,MAAA,IAAA,EAAA,EAPA;AAQA,MAAA,SAAA,EAAA;AARA,KAAA;AAUA,GA5BA;AA6BA,EAAA,QAAA,EAAA;AACA,IAAA,QADA,sBACA;AACA,UAAA,OAAA,GAAA,MAAA,CAAA,QAAA,CAAA,IAAA;AACA,aAAA,OAAA,CAAA,SAAA,CAAA,OAAA,CAAA,WAAA,CAAA,GAAA,IAAA,CAAA,CAAA;AACA,KAJA;AAKA,IAAA,iBALA,+BAKA;AACA,aAAA,KAAA,aAAA,IAAA,KAAA,aAAA,CAAA,MAAA;AACA,KAPA;AAQA,IAAA,mBARA,iCAQA;AACA,aAAA,KAAA,aAAA,IAAA,KAAA,aAAA,CAAA,gBAAA;AACA,KAVA;AAWA,IAAA,gBAXA,8BAWA;AACA,aAAA,EAAA,KAAA,cAAA,IAAA,KAAA,QAAA,CAAA;AACA,KAbA;AAcA,IAAA,gBAdA,8BAcA;AACA,aAAA,KAAA,iBAAA,IAAA,KAAA,YAAA;AACA,KAhBA;AAiBA,IAAA,kBAjBA,gCAiBA;AACA,aAAA,CAAA,KAAA,mBAAA,IAAA,KAAA,iBAAA;AACA,KAnBA;AAoBA,IAAA,qBApBA,mCAoBA;AACA,aAAA,CAAA,CAAA,KAAA,YAAA;AACA,KAtBA;AAuBA,IAAA,uBAvBA,qCAuBA;AACA,aAAA,CAAA,CAAA,KAAA,iBAAA;AACA,KAzBA;AA0BA,IAAA,OA1BA,qBA0BA;AACA,UAAA,KAAA,YAAA,EAAA;AACA,eAAA,KAAA,YAAA;AACA;;AACA,aAAA,KAAA,EAAA,CAAA,+BAAA,CAAA;AACA;AA/BA,GA7BA;AA8DA,EAAA,OA9DA,qBA8DA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,cAAA,KAAA,CAAA,gBAAA;;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,GAhEA;AAiEA,EAAA,OAAA,EAAA;AACA,IAAA,YADA,wBACA,MADA,EACA;AACA,WAAA,cAAA,GAAA,MAAA;AACA,WAAA,mBAAA;AACA,KAJA;AAKA,IAAA,YALA,wBAKA,OALA,EAKA;AACA,WAAA,eAAA,GAAA,OAAA;AACA,WAAA,mBAAA;AACA,KARA;AASA,IAAA,gBATA,8BASA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACA,gBAAA,MAAA,CAAA,SAAA,GAAA,IAAA;AADA;AAAA;AAAA,uBAGA,iBAAA,CAAA;AAAA,kBAAA,IAAA,EAAA,MAAA,CAAA;AAAA,iBAAA,CAHA;;AAAA;AAGA,gBAAA,MAHA;AAIA,gBAAA,MAAA,CAAA,IAAA,GAAA,MAAA,CAAA,IAAA,CAAA,gBAAA;AACA,gBAAA,MAAA,CAAA,SAAA,GAAA,MAAA,CAAA,IAAA,CAAA,UAAA;AACA,gBAAA,MAAA,CAAA,aAAA,GAAA,MAAA,aAAA,MAAA,uCAAA,MAAA,CAAA,IAAA,iDAAA,aAAA,oBAAA;AACA,gBAAA,MAAA,CAAA,cAAA,2BAAA,MAAA,CAAA,aAAA,yDAAA,qBAAA,MAAA;AACA,gBAAA,MAAA,CAAA,eAAA,GAAA,0BAAA,MAAA,CAAA,aAAA,gFAAA,gBAAA,KAAA,EAAA;;AACA,gBAAA,MAAA,CAAA,SAAA,CAAA,MAAA,CAAA,IAAA,CAAA,MAAA;;AATA;AAAA;;AAAA;AAAA;AAAA;AAWA,gBAAA,YAXA,kFAWA,aAAA,QAXA,4EAWA,gBAAA,IAXA,yDAWA,qBAAA,OAXA;AAYA,gBAAA,MAAA,CAAA,YAAA,GAAA,YAAA,IAAA,MAAA,CAAA,EAAA,CAAA,0BAAA,CAAA;;AAZA;AAAA;AAcA,gBAAA,MAAA,CAAA,SAAA,GAAA,KAAA;AAdA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBA,KAzBA;AA0BA,IAAA,mBA1BA,iCA0BA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACA,gBAAA,MAAA,CAAA,UAAA,GAAA,IAAA;AADA;AAGA,gBAAA,IAHA,GAGA;AACA,kBAAA,OAAA,EAAA;AACA,oBAAA,gBAAA,EAAA;AACA,sBAAA,oBAAA,EAAA;AACA,wBAAA,MAAA,EAAA,MAAA,CAAA,cADA;AAEA,wBAAA,gBAAA,EAAA,MAAA,CAAA;AAFA;AADA;AADA;AADA,iBAHA;AAAA;AAAA,uBAaA,YAAA,CAAA;AACA,kBAAA,IAAA,EAAA,MAAA,CAAA,QADA;AAEA,kBAAA,IAAA,EAAA;AAFA,iBAAA,CAbA;;AAAA;AAiBA,gBAAA,MAAA,CAAA,aAAA,GAAA;AACA,kBAAA,MAAA,EAAA,MAAA,CAAA,cADA;AAEA,kBAAA,gBAAA,EAAA,MAAA,CAAA;AAFA,iBAAA;AAjBA;AAAA;;AAAA;AAAA;AAAA;AAsBA,gBAAA,YAtBA,mFAsBA,aAAA,QAtBA,8EAsBA,iBAAA,IAtBA,0DAsBA,sBAAA,OAtBA;AAuBA,gBAAA,MAAA,CAAA,YAAA,GAAA,YAAA,IAAA,MAAA,CAAA,EAAA,CAAA,0BAAA,CAAA;;AAvBA;AAAA;AAyBA,gBAAA,MAAA,CAAA,UAAA,GAAA,KAAA;AAzBA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA2BA,KArDA;AAsDA,IAAA,SAtDA,qBAsDA,MAtDA,EAsDA;AACA,WAAA,KAAA,CAAA,KAAA,CAAA,MAAA,GAAA,MAAA,IAAA,IAAA;AACA;AAxDA;AAjEA,CAAA","sourcesContent":["<template>\n  <div\n    v-if=\"isLoading\"\n    class=\"flex flex-1 items-center h-full bg-black-25 justify-center\"\n  >\n    <spinner size=\"\" />\n  </div>\n  <div\n    v-else\n    class=\"w-full h-full flex overflow-auto bg-slate-50 items-center justify-center\"\n  >\n    <div\n      class=\"flex bg-white shadow-lg rounded-lg flex-col w-full lg:w-2/5 h-full lg:h-auto\"\n    >\n      <div class=\"w-full my-0 m-auto px-12 pt-12 pb-6\">\n        <img v-if=\"logo\" :src=\"logo\" alt=\"Chatwoot logo\" class=\"logo mb-6\" />\n        <p\n          v-if=\"!isRatingSubmitted\"\n          class=\"text-black-700 text-lg leading-relaxed mb-8\"\n        >\n          {{ $t('SURVEY.DESCRIPTION', { inboxName }) }}\n        </p>\n        <banner\n          v-if=\"shouldShowBanner\"\n          :show-success=\"shouldShowSuccessMesage\"\n          :show-error=\"shouldShowErrorMesage\"\n          :message=\"message\"\n        />\n        <label\n          v-if=\"!isRatingSubmitted\"\n          class=\"text-base font-medium text-black-800 mb-4\"\n        >\n          {{ $t('SURVEY.RATING.LABEL') }}\n        </label>\n        <rating\n          :selected-rating=\"selectedRating\"\n          @selectRating=\"selectRating\"\n        />\n        <feedback\n          v-if=\"enableFeedbackForm\"\n          :is-updating=\"isUpdating\"\n          :is-button-disabled=\"isButtonDisabled\"\n          :selected-rating=\"selectedRating\"\n          @sendFeedback=\"sendFeedback\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <branding />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Branding from 'shared/components/Branding';\nimport Spinner from 'shared/components/Spinner';\nimport Rating from 'survey/components/Rating';\nimport Feedback from 'survey/components/Feedback';\nimport Banner from 'survey/components/Banner';\nimport configMixin from 'shared/mixins/configMixin';\nimport { getSurveyDetails, updateSurvey } from 'survey/api/survey';\nimport alertMixin from 'shared/mixins/alertMixin';\n\nexport default {\n  name: 'Response',\n  components: {\n    Branding,\n    Rating,\n    Spinner,\n    Banner,\n    Feedback,\n  },\n  mixins: [alertMixin, configMixin],\n  props: {\n    showHomePage: {\n      type: Boolean,\n      default: false,\n    },\n  },\n\n  data() {\n    return {\n      surveyDetails: null,\n      isLoading: false,\n      errorMessage: null,\n      selectedRating: null,\n      feedbackMessage: '',\n      isUpdating: false,\n      logo: '',\n      inboxName: '',\n    };\n  },\n  computed: {\n    surveyId() {\n      const pageURL = window.location.href;\n      return pageURL.substring(pageURL.lastIndexOf('/') + 1);\n    },\n    isRatingSubmitted() {\n      return this.surveyDetails && this.surveyDetails.rating;\n    },\n    isFeedbackSubmitted() {\n      return this.surveyDetails && this.surveyDetails.feedback_message;\n    },\n    isButtonDisabled() {\n      return !(this.selectedRating && this.feedback);\n    },\n    shouldShowBanner() {\n      return this.isRatingSubmitted || this.errorMessage;\n    },\n    enableFeedbackForm() {\n      return !this.isFeedbackSubmitted && this.isRatingSubmitted;\n    },\n    shouldShowErrorMesage() {\n      return !!this.errorMessage;\n    },\n    shouldShowSuccessMesage() {\n      return !!this.isRatingSubmitted;\n    },\n    message() {\n      if (this.errorMessage) {\n        return this.errorMessage;\n      }\n      return this.$t('SURVEY.RATING.SUCCESS_MESSAGE');\n    },\n  },\n  async mounted() {\n    this.getSurveyDetails();\n  },\n  methods: {\n    selectRating(rating) {\n      this.selectedRating = rating;\n      this.updateSurveyDetails();\n    },\n    sendFeedback(message) {\n      this.feedbackMessage = message;\n      this.updateSurveyDetails();\n    },\n    async getSurveyDetails() {\n      this.isLoading = true;\n      try {\n        const result = await getSurveyDetails({ uuid: this.surveyId });\n        this.logo = result.data.inbox_avatar_url;\n        this.inboxName = result.data.inbox_name;\n        this.surveyDetails = result?.data?.csat_survey_response;\n        this.selectedRating = this.surveyDetails?.rating;\n        this.feedbackMessage = this.surveyDetails?.feedback_message || '';\n        this.setLocale(result.data.locale);\n      } catch (error) {\n        const errorMessage = error?.response?.data?.message;\n        this.errorMessage = errorMessage || this.$t('SURVEY.API.ERROR_MESSAGE');\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    async updateSurveyDetails() {\n      this.isUpdating = true;\n      try {\n        const data = {\n          message: {\n            submitted_values: {\n              csat_survey_response: {\n                rating: this.selectedRating,\n                feedback_message: this.feedbackMessage,\n              },\n            },\n          },\n        };\n        await updateSurvey({\n          uuid: this.surveyId,\n          data,\n        });\n        this.surveyDetails = {\n          rating: this.selectedRating,\n          feedback_message: this.feedbackMessage,\n        };\n      } catch (error) {\n        const errorMessage = error?.response?.data?.message;\n        this.errorMessage = errorMessage || this.$t('SURVEY.API.ERROR_MESSAGE');\n      } finally {\n        this.isUpdating = false;\n      }\n    },\n    setLocale(locale) {\n      this.$root.$i18n.locale = locale || 'en';\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n@import '~widget/assets/scss/variables.scss';\n\n.logo {\n  max-height: $space-larger;\n}\n</style>\n"],"sourceRoot":"app/javascript/survey/views"},"metadata":{},"sourceType":"module"}