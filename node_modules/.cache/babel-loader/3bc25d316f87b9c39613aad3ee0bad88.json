{"ast":null,"code":"var _a, _b;\n\nimport { __awaiter, __generator } from \"tslib\";\nimport { isServer } from '../../core/environment';\nimport { loadScript } from '../../lib/load-script';\nimport { getCDN } from '../../lib/parse-cdn';\nvar cdn = (_b = (_a = window.analytics) === null || _a === void 0 ? void 0 : _a._cdn) !== null && _b !== void 0 ? _b : getCDN();\nvar path = cdn + '/next-integrations';\nexport function remoteMiddlewares(ctx, settings) {\n  var _a;\n\n  return __awaiter(this, void 0, void 0, function () {\n    var remoteMiddleware, names, scripts, middleware;\n\n    var _this = this;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          if (isServer()) {\n            return [2\n            /*return*/\n            , []];\n          }\n\n          remoteMiddleware = (_a = settings.enabledMiddleware) !== null && _a !== void 0 ? _a : {};\n          names = Object.keys(remoteMiddleware);\n          scripts = names.map(function (name) {\n            return __awaiter(_this, void 0, void 0, function () {\n              var nonNamespaced, fullPath, error_1;\n              return __generator(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    nonNamespaced = name.replace('@segment/', '');\n                    fullPath = path + \"/middleware/\" + nonNamespaced + \"/latest/\" + nonNamespaced + \".js.gz\";\n                    _a.label = 1;\n\n                  case 1:\n                    _a.trys.push([1, 3,, 4]);\n\n                    return [4\n                    /*yield*/\n                    , loadScript(fullPath) // @ts-ignore\n                    ];\n\n                  case 2:\n                    _a.sent(); // @ts-ignore\n\n\n                    return [2\n                    /*return*/\n                    , window[nonNamespaced + \"Middleware\"]];\n\n                  case 3:\n                    error_1 = _a.sent();\n                    ctx.log('error', error_1);\n                    ctx.stats.increment('failed_remote_middleware');\n                    return [3\n                    /*break*/\n                    , 4];\n\n                  case 4:\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          });\n          return [4\n          /*yield*/\n          , Promise.all(scripts)];\n\n        case 1:\n          middleware = _b.sent();\n          middleware = middleware.filter(Boolean);\n          return [2\n          /*return*/\n          , middleware];\n      }\n    });\n  });\n}","map":null,"metadata":{},"sourceType":"module"}