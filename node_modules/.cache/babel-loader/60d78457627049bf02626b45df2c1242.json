{"ast":null,"code":"import \"regenerator-runtime/runtime.js\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptor.js\";\nimport \"core-js/modules/es.object.get-own-property-descriptors.js\";\nimport \"core-js/modules/es.promise.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapGetters } from 'vuex';\nimport alertMixin from 'shared/mixins/alertMixin';\nimport hookMixin from './hookMixin';\nexport default {\n  mixins: [alertMixin, hookMixin],\n  props: {\n    integration: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {\n      endPoint: '',\n      alertMessage: '',\n      values: {}\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters({\n    uiFlags: 'integrations/getUIFlags',\n    websiteInboxes: 'inboxes/getWebsiteInboxes',\n    dialogFlowEnabledInboxes: 'inboxes/dialogFlowEnabledInboxes'\n  })), {}, {\n    inboxes: function inboxes() {\n      var _this = this;\n\n      return this.dialogFlowEnabledInboxes.filter(function (inbox) {\n        if (!_this.isIntegrationDialogflow) {\n          return true;\n        }\n\n        return !_this.connectedDialogflowInboxIds.includes(inbox.id);\n      }).map(function (inbox) {\n        return {\n          label: inbox.name,\n          value: inbox.id\n        };\n      });\n    },\n    connectedDialogflowInboxIds: function connectedDialogflowInboxIds() {\n      if (!this.isIntegrationDialogflow) {\n        return [];\n      }\n\n      return this.integration.hooks.map(function (hook) {\n        var _hook$inbox;\n\n        return (_hook$inbox = hook.inbox) === null || _hook$inbox === void 0 ? void 0 : _hook$inbox.id;\n      });\n    },\n    formItems: function formItems() {\n      return this.integration.settings_form_schema;\n    },\n    isIntegrationDialogflow: function isIntegrationDialogflow() {\n      return this.integration.id === 'dialogflow';\n    }\n  }),\n  methods: {\n    onClose: function onClose() {\n      this.$emit('close');\n    },\n    buildHookPayload: function buildHookPayload() {\n      var _this2 = this;\n\n      var hookPayload = {\n        app_id: this.integration.id,\n        settings: {}\n      };\n      hookPayload.settings = Object.keys(this.values).reduce(function (acc, key) {\n        if (key !== 'inbox') {\n          acc[key] = _this2.values[key];\n        }\n\n        return acc;\n      }, {});\n      this.formItems.forEach(function (item) {\n        if (item.validation.includes('JSON')) {\n          hookPayload.settings[item.name] = JSON.parse(hookPayload.settings[item.name]);\n        }\n      });\n\n      if (this.isHookTypeInbox && this.values.inbox) {\n        hookPayload.inbox_id = this.values.inbox;\n      }\n\n      return hookPayload;\n    },\n    submitForm: function submitForm() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _error$response, _error$response$data, errorMessage;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return _this3.$store.dispatch('integrations/createHook', _this3.buildHookPayload());\n\n              case 3:\n                _this3.alertMessage = _this3.$t('INTEGRATION_APPS.ADD.API.SUCCESS_MESSAGE');\n\n                _this3.onClose();\n\n                _context.next = 11;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                errorMessage = _context.t0 === null || _context.t0 === void 0 ? void 0 : (_error$response = _context.t0.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message;\n                _this3.alertMessage = errorMessage || _this3.$t('INTEGRATION_APPS.ADD.API.ERROR_MESSAGE');\n\n              case 11:\n                _context.prev = 11;\n\n                _this3.showAlert(_this3.alertMessage);\n\n                return _context.finish(11);\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 7, 11, 14]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"sources":["NewHook.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"column content-box\">\n    <woot-modal-header\n      :header-title=\"integration.name\"\n      :header-content=\"integration.description\"\n    />\n    <formulate-form\n      #default=\"{ hasErrors }\"\n      v-model=\"values\"\n      @submit=\"submitForm\"\n    >\n      <formulate-input\n        v-for=\"item in formItems\"\n        :key=\"item.name\"\n        v-bind=\"item\"\n      />\n      <formulate-input\n        v-if=\"isHookTypeInbox\"\n        :options=\"inboxes\"\n        type=\"select\"\n        name=\"inbox\"\n        :placeholder=\"$t('INTEGRATION_APPS.ADD.FORM.INBOX.LABEL')\"\n        :label=\"$t('INTEGRATION_APPS.ADD.FORM.INBOX.PLACEHOLDER')\"\n        validation=\"required\"\n        validation-name=\"Inbox\"\n      />\n      <div class=\"modal-footer\">\n        <woot-button :disabled=\"hasErrors\" :loading=\"uiFlags.isCreatingHook\">\n          {{ $t('INTEGRATION_APPS.ADD.FORM.SUBMIT') }}\n        </woot-button>\n        <woot-button class=\"button clear\" @click.prevent=\"onClose\">\n          {{ $t('INTEGRATION_APPS.ADD.FORM.CANCEL') }}\n        </woot-button>\n      </div>\n    </formulate-form>\n  </div>\n</template>\n<script>\nimport { mapGetters } from 'vuex';\nimport alertMixin from 'shared/mixins/alertMixin';\nimport hookMixin from './hookMixin';\n\nexport default {\n  mixins: [alertMixin, hookMixin],\n  props: {\n    integration: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n  data() {\n    return {\n      endPoint: '',\n      alertMessage: '',\n      values: {},\n    };\n  },\n  computed: {\n    ...mapGetters({\n      uiFlags: 'integrations/getUIFlags',\n      websiteInboxes: 'inboxes/getWebsiteInboxes',\n      dialogFlowEnabledInboxes: 'inboxes/dialogFlowEnabledInboxes',\n    }),\n    inboxes() {\n      return this.dialogFlowEnabledInboxes\n        .filter(inbox => {\n          if (!this.isIntegrationDialogflow) {\n            return true;\n          }\n          return !this.connectedDialogflowInboxIds.includes(inbox.id);\n        })\n        .map(inbox => ({ label: inbox.name, value: inbox.id }));\n    },\n\n    connectedDialogflowInboxIds() {\n      if (!this.isIntegrationDialogflow) {\n        return [];\n      }\n      return this.integration.hooks.map(hook => hook.inbox?.id);\n    },\n    formItems() {\n      return this.integration.settings_form_schema;\n    },\n    isIntegrationDialogflow() {\n      return this.integration.id === 'dialogflow';\n    },\n  },\n  methods: {\n    onClose() {\n      this.$emit('close');\n    },\n    buildHookPayload() {\n      const hookPayload = {\n        app_id: this.integration.id,\n        settings: {},\n      };\n\n      hookPayload.settings = Object.keys(this.values).reduce((acc, key) => {\n        if (key !== 'inbox') {\n          acc[key] = this.values[key];\n        }\n        return acc;\n      }, {});\n\n      this.formItems.forEach(item => {\n        if (item.validation.includes('JSON')) {\n          hookPayload.settings[item.name] = JSON.parse(\n            hookPayload.settings[item.name]\n          );\n        }\n      });\n\n      if (this.isHookTypeInbox && this.values.inbox) {\n        hookPayload.inbox_id = this.values.inbox;\n      }\n\n      return hookPayload;\n    },\n    async submitForm() {\n      try {\n        await this.$store.dispatch(\n          'integrations/createHook',\n          this.buildHookPayload()\n        );\n        this.alertMessage = this.$t('INTEGRATION_APPS.ADD.API.SUCCESS_MESSAGE');\n        this.onClose();\n      } catch (error) {\n        const errorMessage = error?.response?.data?.message;\n        this.alertMessage =\n          errorMessage || this.$t('INTEGRATION_APPS.ADD.API.ERROR_MESSAGE');\n      } finally {\n        this.showAlert(this.alertMessage);\n      }\n    },\n  },\n};\n</script>\n"],"sourceRoot":"app/javascript/dashboard/routes/dashboard/settings/integrationapps"},"metadata":{},"sourceType":"module"}